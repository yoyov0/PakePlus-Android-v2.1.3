{"name":"dfcebae","url":"https://jovial-bunny-2f9433.netlify.app/","showName":"yoyo player","appid":"com.dfcebae.app","icon":"","iconPath":"C:\\Users\\yoyo\\AppData\\Roaming\\com.pakeplus.pacbao\\dfcebae.png","iconRound":true,"state":true,"single":true,"injectJq":true,"tauriApi":false,"devbug":false,"version":"0.0.3","preview":"Android","platform":["1-1"],"width":412,"height":915,"desc":"","jsFile":[],"filterCss":"","customJs":"<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <!-- é’ˆå¯¹Androidè®¾å¤‡çš„ç‰¹æ®Šmetaæ ‡ç­¾ -->\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, viewport-fit=cover\">\n    <meta name=\"apple-mobile-web-app-capable\" content=\"yes\">\n    <meta name=\"apple-mobile-web-app-status-bar-style\" content=\"black-translucent\">\n    <meta name=\"mobile-web-app-capable\" content=\"yes\">\n    <meta name=\"theme-color\" content=\"#000000\">\n    <meta name=\"format-detection\" content=\"telephone=no\">\n    <meta name=\"HandheldFriendly\" content=\"true\">\n    <!-- é’ˆå¯¹Android WebViewçš„ç‰¹æ®Šé…ç½® -->\n    <meta http-equiv=\"Content-Security-Policy\" content=\"default-src * 'self' 'unsafe-inline' 'unsafe-eval' data: gap: content:\">\n    <link rel=\"apple-touch-icon\" href=\"https://chatbotcos.weixin.qq.com/chatbot/30-openaiassets_0fcbc917653b4f5350f3290e2343fdaf_469401762766962387.jpg\">\n    <!-- ä¿®æ”¹1: æ ‡é¢˜æ”¹ä¸º\"â™¡å‘¦ã®éŸ³ä¹â™¡æ’­æ”¾å™¨\" -->\n    <title>â™¡å‘¦ã®éŸ³ä¹â™¡æ’­æ”¾å™¨</title>\n    <!-- Dexie.js for Database -->\n    <script src=\"https://unpkg.com/dexie@latest/dist/dexie.js\"></script>\n    <!-- Cropper.js for Image Cropping -->\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js\"></script>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css\">\n    <!-- JSZip for efficient data export/import -->\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js\"></script>\n    <style>\n        :root { /* Night Mode */ --bg-primary: #121212; --bg-secondary: #191919; --bg-tertiary: #282828; --bg-app: rgba(40, 40, 40, 0.7); --text-primary: #ffffff; --text-secondary: #b3b3b3; --border-color: #444; --global-font: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif; --lyric-color: #ffffff; --global-font-size: 16px; }\n        body.light-mode { /* Day Mode */ --bg-primary: #f0f2f5; --bg-secondary: #ffffff; --bg-tertiary: #e9e9e9; --bg-app: rgba(255, 255, 255, 0.6); --text-primary: #000000; --text-secondary: #555555; --border-color: #dcdcdc; }\n        html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: var(--global-font); color: var(--text-primary); background-color: var(--bg-primary); transition: background-color 0.3s, color 0.3s; font-size: var(--global-font-size); -webkit-tap-highlight-color: transparent; -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; touch-action: manipulation; }\n        .view { position: absolute; top: 0; left: 0; width: 100%; height: 100%; box-sizing: border-box; transition: opacity 0.4s ease, transform 0.4s ease; opacity: 0; transform: scale(1.05); pointer-events: none; background-color: var(--bg-primary); }\n        .view.active { opacity: 1; transform: scale(1); pointer-events: auto; }\n        button, input[type=\"file\"], select { cursor: pointer; -webkit-appearance: none; appearance: none; outline: none; }\n        button:disabled { cursor: not-allowed; opacity: 0.7; }\n        input[type=\"file\"] { font-size: 14px; }\n        /* é’ˆå¯¹Androidè®¾å¤‡çš„æ–‡ä»¶ä¸Šä¼ æŒ‰é’®æ ·å¼ */\n        input[type=\"file\"]::-webkit-file-upload-button { \n            background: #1DB954; \n            color: white; \n            border: none; \n            padding: 10px 15px; \n            border-radius: 6px; \n            font-size: 14px;\n            font-weight: bold;\n        }\n        input[type=\"file\"]:active::-webkit-file-upload-button {\n            background: #1aa34a;\n            transform: scale(0.98);\n        }\n        #desktop-view { background-size: cover; background-position: center; display: flex; flex-direction: column; padding: 20px; }\n        .desktop-header { text-align: center; text-shadow: 0 0 10px rgba(0,0,0,0.7); }\n        .desktop-time { font-size: 72px; font-weight: 600; }\n        .desktop-date { font-size: 22px; opacity: 0.9; margin-top: 4px; }\n        .desktop-top-right { position: absolute; top: 20px; right: 20px; }\n        #announcement-btn { background: none; border: none; font-size: 24px; color: var(--text-primary); text-shadow: 0 0 5px rgba(0,0,0,0.5); display: none; }\n        .desktop-main { display: flex; flex: 1; justify-content: center; align-items: center; gap: 30px; }\n        .app-dock { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }\n        .app-icon { display: flex; flex-direction: column; align-items: center; text-decoration: none; color: var(--text-primary); width: 70px; }\n        .app-icon .icon-bg { width: 55px; height: 55px; background-color: var(--bg-app); border-radius: 15px; display: flex; justify-content: center; align-items: center; margin-bottom: 8px; transition: all 0.3s; background-size: cover; background-position: center; font-size: 28px; }\n        .app-icon:hover .icon-bg { transform: scale(1.1); }\n        .app-icon span { font-size: 12px; text-shadow: 0 0 5px rgba(0,0,0,0.5); text-align: center; }\n        #display-picture-container { width: 130px; height: 130px; background-color: var(--bg-app); border-radius: 20px; cursor: pointer; background-size: cover; background-position: center; transition: transform 0.3s; }\n        .app-page { background-color: var(--bg-secondary); display: flex; flex-direction: column; }\n        .app-header { padding: 15px; background-color: var(--bg-tertiary); display: flex; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 10;}\n        .app-header .back-btn, .app-header h1 { color: var(--text-primary); } .app-header .back-btn { font-size: 24px; background: none; border: none; margin-right: 15px; } .app-header h1 { font-size: calc(var(--global-font-size) + 4px); margin: 0; }\n        .app-content { padding: 20px; overflow-y: auto; flex-grow: 1; -webkit-overflow-scrolling: touch; }\n        .form-group { margin-bottom: 20px; } .form-group label { display: block; margin-bottom: 8px; color: var(--text-secondary); } .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px; background-color: var(--bg-tertiary); border: 1px solid var(--border-color); color: var(--text-primary); border-radius: 4px; box-sizing: border-box; font-size: inherit; -webkit-appearance: none; appearance: none; }\n        .form-group textarea { resize: vertical; min-height: 100px; }\n        .action-button { width: 100%; padding: 15px; background-color: #1DB954; color: white; border: none; border-radius: 8px; font-weight: bold; margin-top: 10px; font-size: var(--global-font-size); transition: background-color 0.2s, transform 0.1s; }\n        .action-button:active { background-color: #1aa34a; transform: scale(0.98); }\n        \n        /* Playlist & Folder Styles */\n        #playlist-container { list-style: none; padding: 0; margin: 0; display: none; }\n        .playlist-item { display: flex; align-items: center; padding: 10px; border-radius: 8px; transition: background-color 0.2s; } .playlist-item:hover { background-color: var(--bg-tertiary); }\n        .playlist-item img { width: 50px; height: 50px; border-radius: 4px; margin-right: 15px; object-fit: cover; background-color: #333; }\n        .playlist-item .song-info { flex-grow: 1; cursor: pointer; } .playlist-item .actions { display: flex; } .playlist-item .actions button { background: none; border: none; font-size: 20px; padding: 10px; color: var(--text-secondary); }\n        \n        .folder-grid { display: none; } /* æ”¹ä¸ºåˆ—è¡¨æ˜¾ç¤º */\n        .folder-item { background-color: var(--bg-tertiary); border-radius: 12px; padding: 20px 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: transform 0.2s; position: relative; user-select: none; -webkit-user-select: none; }\n        .folder-item:active { transform: scale(0.95); background-color: var(--border-color); }\n        .folder-icon { font-size: 40px; margin-bottom: 10px; }\n        .folder-name { font-size: 14px; text-align: center; word-break: break-all; }\n        .folder-count { font-size: 12px; color: var(--text-secondary); margin-top: 4px; }\n        .folder-delete-btn { position: absolute; top: 5px; right: 5px; background: none; border: none; color: #ff5555; font-size: 16px; padding: 5px; opacity: 0.7; z-index: 2; }\n        .folder-delete-btn:hover { opacity: 1; }\n        #create-folder-btn { margin-left: auto; background: none; border: none; font-size: 24px; color: var(--text-primary); }\n\n        #player-view { background-color: #000; background-size: cover; background-position: center; display: flex; flex-direction: column; padding: 20px; box-sizing: border-box; transition: transform 0.4s ease; }\n        \n        .player-top-bar { display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }\n        .player-top-bar button { color: white; text-shadow: 0 0 5px black; background: none; border: none; font-size: 24px;}\n        .player-top-bar .right-controls { display: flex; align-items: center; gap: 10px; position: relative; }\n        .player-top-bar .right-controls button {\n            background-color: rgba(255, 255, 255, 0.2);\n            border-radius: 12px;\n            width: 40px;\n            height: 40px;\n            font-size: 20px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            text-shadow: none;\n            color: #fff;\n            backdrop-filter: blur(5px);\n        }\n        #player-content-wrapper { position: relative; flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; overflow: hidden; }\n        #album-art { position: absolute; object-fit: cover; border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.5); cursor: grab; touch-action: none; transition: transform 0.1s; }\n        #album-art.dragging { cursor: grabbing; box-shadow: 0 12px 35px rgba(0,0,0,0.7); transition: none; }\n        \n        .lyric-bubble { position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); width: 90%; background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 15px 20px; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); cursor: grab; z-index: 10; touch-action: none; text-align: center; transition: transform 0.1s; }\n        .lyric-bubble.dragging { cursor: grabbing; transition: none; }\n        .lyric-bubble p { margin: 0; color: var(--lyric-color); font-size: calc(var(--global-font-size) + 2px); }\n        \n        /* New Song Title Box */\n        #song-title-box {\n            position: absolute;\n            top: 15%; /* Default position above lyrics/art usually */\n            left: 50%;\n            transform: translateX(-50%);\n            background: rgba(0, 0, 0, 0.5);\n            border: 1px solid rgba(255, 255, 255, 0.2);\n            border-radius: 8px;\n            padding: 8px 15px;\n            color: white;\n            font-size: 14px;\n            backdrop-filter: blur(5px);\n            cursor: grab;\n            z-index: 9;\n            touch-action: none;\n            max-width: 80%;\n            white-space: nowrap;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            transition: transform 0.1s;\n        }\n        #song-title-box.dragging { cursor: grabbing; transition: none; }\n\n        .player-controls { width: 100%; padding: 10px 0; color: white; flex-shrink: 0; }\n        .progress-bar-container { display: flex; align-items: center; gap: 10px; width: 100%; font-size: 12px; }\n        #progress-bar { flex-grow: 1; -webkit-appearance: none; appearance: none; width: 100%; height: 5px; background: rgba(255,255,255,0.3); border-radius: 5px; outline: none; transition: opacity .2s; }\n        #progress-bar::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 15px; height: 15px; background: #fff; border-radius: 50%; cursor: pointer; }\n        .main-controls { display: flex; justify-content: center; align-items: center; margin-top: 15px; gap: 20px; }\n        .main-controls button { background: none; border: none; display: flex; align-items: center; justify-content: center; padding: 0; color: white; text-shadow: 0 0 5px rgba(0,0,0,0.5); }\n        #play-pause-btn { background-color: rgba(255, 255, 255, 0.9); color: #000; border-radius: 50%; width: 55px; height: 55px; font-size: 28px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); transition: background-color 0.3s, color 0.3s; text-shadow: none; }\n        #prev-btn, #next-btn { font-size: 30px; opacity: 0.9; }\n        body.light-mode #play-pause-btn { background-color: rgba(0, 0, 0, 0.7); color: #fff; }\n        #player-settings-menu { display: none; position: absolute; top: 110%; right: 0; background: var(--bg-tertiary); border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.4); padding: 10px; width: 200px; z-index: 20; }\n        #player-settings-menu.visible { display: block; }\n        #player-settings-menu a { display: block; padding: 8px 12px; color: var(--text-primary); text-decoration: none; border-radius: 4px; }\n        #player-settings-menu a:hover { background: var(--border-color); }\n        .menu-section { padding-top: 8px; margin-top: 8px; border-top: 1px solid var(--border-color); }\n        .menu-section-title { font-size: 12px; color: var(--text-secondary); padding: 0 12px 4px; }\n        .speed-control { display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; }\n        #playback-speed { background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 4px; }\n        #color-picker { display: none; position: absolute; top: 60px; right: 20px; background-color: #282828; padding: 10px; border-radius: 8px; grid-template-columns: repeat(4, 1fr); gap: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.4); z-index: 20;}\n        #color-picker.visible { display: grid; }\n        .color-swatch { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; } .color-swatch:hover { border-color: white; }\n        .beautify-section { border-bottom: 1px solid var(--border-color); padding-bottom: 20px; margin-bottom: 20px; }\n        .app-customize-row { display: flex; align-items: center; gap: 15px; margin-bottom: 10px; }\n        .app-customize-row .preview-icon { width: 50px; height: 50px; border-radius: 10px; object-fit: cover; background-color: var(--bg-tertiary); flex-shrink: 0; }\n        .app-customize-row .app-name-input { flex-grow: 1; padding: 10px; background-color: var(--bg-tertiary); border: 1px solid var(--border-color); color: var(--text-primary); border-radius: 4px; }\n        .app-customize-row .select-file-btn { padding: 8px 12px; font-size: 13px; background-color: #03A9F4; color: white; border: none; border-radius: 4px; white-space: nowrap; transition: background-color 0.2s, transform 0.1s; }\n        .app-customize-row .select-file-btn:active { background-color: #039be5; transform: scale(0.98); }\n        .input-with-button { display: flex; gap: 10px; }\n        .input-with-button input { flex-grow: 1; }\n        .input-with-button button { padding: 10px 15px; background-color: #1DB954; color: white; border: none; border-radius: 4px; transition: background-color 0.2s, transform 0.1s; }\n        .input-with-button button:active { background-color: #1aa34a; transform: scale(0.98); }\n        .font-size-control { display: flex; align-items: center; gap: 15px; }\n        .font-size-control input[type=\"range\"] { flex-grow: 1; }\n        .font-size-control span { font-weight: bold; min-width: 40px; text-align: right; }\n        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 1000; }\n        .modal-content { background: var(--bg-secondary); padding: 25px; border-radius: 12px; max-width: 90%; width: 350px; box-shadow: 0 5px 20px rgba(0,0,0,0.3); } .modal-content button { float: right; }\n        #crop-modal-content { width: 90vw; max-width: 500px; padding: 10px; } #cropper-container { width: 100%; height: 60vh; max-height: 400px; } #cropper-image { display: block; max-width: 100%; } .cropper-buttons { text-align: right; margin-top: 10px; }\n        .image-preview { width: 50px; height: 50px; border-radius: 4px; object-fit: contain; margin-left: 10px; background-color: var(--bg-tertiary); }\n        .switch { position:relative;display:inline-block;width:60px;height:34px} .switch input{opacity:0;width:0;height:0} .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:.4s;border-radius:34px} .slider:before{position:absolute;content:\"\";height:26px;width:26px;left:4px;bottom:4px;background-color:white;transition:.4s;border-radius:50%} input:checked+.slider{background-color:#2196F3} input:checked+.slider:before{transform:translateX(26px)}\n        .source-switcher { display: flex; gap: 20px; margin-bottom: 10px; }\n        .hidden-input { display: none; }\n        .import-vtt-btn { margin-bottom: 5px; font-size: 12px; background-color: var(--bg-tertiary); border: 1px solid var(--border-color); color: var(--text-primary); padding: 5px 10px; border-radius: 4px; transition: background-color 0.2s, transform 0.1s; }\n        .import-vtt-btn:active { background-color: var(--border-color); transform: scale(0.98); }\n\n        /* Full Page Lyrics Modal */\n        #full-lyrics-modal {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0, 0, 0, 0.95);\n            z-index: 2000;\n            display: flex;\n            flex-direction: column;\n            transform: translateY(100%);\n            transition: transform 0.3s ease;\n        }\n        #full-lyrics-modal.active { transform: translateY(0); }\n        .full-lyrics-header { padding: 20px; display: flex; justify-content: flex-end; }\n        .close-lyrics-btn { background: none; border: none; color: white; font-size: 30px; opacity: 0.7; }\n        .full-lyrics-container {\n            flex-grow: 1;\n            overflow-y: auto;\n            padding: 20px;\n            text-align: center;\n            -webkit-mask-image: linear-gradient(to bottom, transparent, black 15%, black 85%, transparent);\n            mask-image: linear-gradient(to bottom, transparent, black 15%, black 85%, transparent);\n        }\n        .full-lyric-line {\n            padding: 12px 5px;\n            color: #888;\n            font-size: 18px;\n            transition: all 0.3s;\n            cursor: pointer;\n        }\n        .full-lyric-line.active {\n            color: var(--lyric-color);\n            font-size: 24px;\n            font-weight: bold;\n            text-shadow: 0 0 10px rgba(255,255,255,0.3);\n            transform: scale(1.05);\n        }\n        \n        /* æ’­æ”¾åˆ—è¡¨åˆ—è¡¨æ ·å¼ */\n        .folder-list { display: none; list-style: none; padding: 0; margin: 0; }\n        .folder-list-item { display: flex; align-items: center; padding: 12px; border-radius: 8px; transition: background-color 0.2s; margin-bottom: 8px; background-color: var(--bg-tertiary); }\n        .folder-list-item:hover { background-color: var(--border-color); }\n        .folder-list-icon { font-size: 24px; margin-right: 15px; }\n        .folder-list-info { flex-grow: 1; }\n        .folder-list-name { font-weight: 500; }\n        .folder-list-count { font-size: 12px; color: var(--text-secondary); margin-top: 2px; }\n        .folder-list-actions { display: flex; }\n        .folder-list-actions button { background: none; border: none; font-size: 16px; padding: 5px; color: var(--text-secondary); }\n        \n        /* ä¿®æ”¹2: æ–°å»ºé€‰é¡¹æ ·å¼ */\n        .new-folder-option { color: inherit !important; font-weight: normal !important; }\n        \n        /* è£è€€æ‰‹æœºæ–‡ä»¶ä¸Šä¼ ç‰¹æ®Šæ ·å¼ */\n        .honor-file-input-container {\n            position: relative;\n            width: 100%;\n            margin-bottom: 10px;\n        }\n        \n        .honor-file-input-button {\n            display: block;\n            width: 100%;\n            padding: 12px 15px;\n            background-color: #1DB954;\n            color: white;\n            border: none;\n            border-radius: 6px;\n            font-size: 15px;\n            font-weight: bold;\n            text-align: center;\n            cursor: pointer;\n            transition: background-color 0.2s, transform 0.1s;\n        }\n        \n        .honor-file-input-button:active {\n            background-color: #1aa34a;\n            transform: scale(0.98);\n        }\n        \n        .honor-file-input-real {\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            opacity: 0;\n            cursor: pointer;\n            z-index: 10;\n        }\n        \n        /* è£è€€æ‰‹æœºæƒé™å¼•å¯¼é¡µé¢ */\n        #honor-permission-guide {\n            display: none;\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0, 0, 0, 0.9);\n            z-index: 9999;\n            padding: 20px;\n            box-sizing: border-box;\n            overflow-y: auto;\n            color: white;\n        }\n        \n        #honor-permission-guide.active {\n            display: block;\n        }\n        \n        .permission-guide-content {\n            background: #333;\n            padding: 20px;\n            border-radius: 10px;\n            margin-top: 20px;\n        }\n        \n        .permission-step {\n            margin-bottom: 20px;\n            padding: 15px;\n            background: #444;\n            border-radius: 8px;\n        }\n        \n        .permission-step h3 {\n            margin-top: 0;\n            color: #1DB954;\n        }\n        \n        .permission-step img {\n            max-width: 100%;\n            border-radius: 5px;\n            margin-top: 10px;\n        }\n        \n        /* æ–‡ä»¶ä¸Šä¼ çŠ¶æ€æç¤º */\n        .file-upload-status {\n            position: fixed;\n            top: 20px;\n            left: 50%;\n            transform: translateX(-50%);\n            background: rgba(0,0,0,0.8);\n            color: white;\n            padding: 12px 20px;\n            border-radius: 8px;\n            z-index: 1001;\n            display: none;\n            font-size: 14px;\n            max-width: 80%;\n            text-align: center;\n            box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n        }\n        \n        .file-upload-status.active {\n            display: block;\n            animation: fadeInOut 3s ease-in-out;\n        }\n        \n        @keyframes fadeInOut {\n            0% { opacity: 0; transform: translateX(-50%) translateY(-20px); }\n            10% { opacity: 1; transform: translateX(-50%) translateY(0); }\n            90% { opacity: 1; transform: translateX(-50%) translateY(0); }\n            100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }\n        }\n        \n        /* å¤§æ–‡ä»¶è­¦å‘Š */\n        .file-size-warning {\n            display: none;\n            background: #ff9800;\n            color: white;\n            padding: 8px 12px;\n            border-radius: 4px;\n            margin-top: 5px;\n            font-size: 12px;\n        }\n        \n        .file-size-warning.active {\n            display: block;\n        }\n        \n        /* æƒé™æµ‹è¯•æŒ‰é’® */\n        .permission-test-btn {\n            background: #ff9800;\n            color: white;\n            border: none;\n            padding: 8px 12px;\n            border-radius: 4px;\n            font-size: 12px;\n            margin-top: 5px;\n            cursor: pointer;\n        }\n        \n        .permission-test-btn:active {\n            background: #f57c00;\n        }\n    </style>\n</head>\n<body>\n    <!-- è£è€€æ‰‹æœºæƒé™å¼•å¯¼é¡µé¢ -->\n    <div id=\"honor-permission-guide\">\n        <div style=\"text-align: center; margin-bottom: 20px;\">\n            <h1 style=\"color: #1DB954;\">ğŸ“ è£è€€æ‰‹æœºæ–‡ä»¶ä¸Šä¼ æƒé™è®¾ç½®æŒ‡å—</h1>\n            <p style=\"color: #ccc; margin-top: 10px;\">è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å¼€å¯æ–‡ä»¶è®¿é—®æƒé™</p>\n        </div>\n        \n        <div class=\"permission-guide-content\">\n            <div class=\"permission-step\">\n                <h3>æ­¥éª¤ 1: è¿›å…¥åº”ç”¨è®¾ç½®</h3>\n                <p>åœ¨æ‰‹æœºæ¡Œé¢æ‰¾åˆ°æœ¬åº”ç”¨å›¾æ ‡ï¼Œé•¿æŒ‰åº”ç”¨å›¾æ ‡ï¼Œé€‰æ‹©ã€Œåº”ç”¨ä¿¡æ¯ã€æˆ–ã€Œåº”ç”¨è¯¦æƒ…ã€</p>\n            </div>\n            \n            <div class=\"permission-step\">\n                <h3>æ­¥éª¤ 2: æ‰¾åˆ°æƒé™ç®¡ç†</h3>\n                <p>åœ¨åº”ç”¨ä¿¡æ¯é¡µé¢ä¸­ï¼Œæ‰¾åˆ°å¹¶ç‚¹å‡»ã€Œæƒé™ã€æˆ–ã€Œæƒé™ç®¡ç†ã€é€‰é¡¹</p>\n            </div>\n            \n            <div class=\"permission-step\">\n                <h3>æ­¥éª¤ 3: å¼€å¯æ–‡ä»¶æƒé™</h3>\n                <p>åœ¨æƒé™åˆ—è¡¨ä¸­ï¼Œæ‰¾åˆ°ä»¥ä¸‹æƒé™å¹¶è®¾ç½®ä¸ºã€Œå…è®¸ã€ï¼š</p>\n                <ul style=\"color: #ccc; padding-left: 20px;\">\n                    <li><strong>å­˜å‚¨æƒé™</strong>ï¼ˆè¯»å–æ‰‹æœºå­˜å‚¨ï¼‰</li>\n                    <li><strong>æ–‡ä»¶è®¿é—®æƒé™</strong></li>\n                    <li><strong>åª’ä½“è®¿é—®æƒé™</strong></li>\n                </ul>\n            </div>\n            \n            <div class=\"permission-step\">\n                <h3>æ­¥éª¤ 4: é‡æ–°å¯åŠ¨åº”ç”¨</h3>\n                <p>è®¾ç½®å®Œæˆåï¼Œè¯·å®Œå…¨å…³é—­åº”ç”¨å¹¶é‡æ–°æ‰“å¼€</p>\n            </div>\n            \n            <div style=\"margin-top: 30px; text-align: center;\">\n                <button id=\"close-permission-guide\" style=\"background: #1DB954; color: white; border: none; padding: 12px 30px; border-radius: 6px; font-size: 16px; cursor: pointer;\">\n                    æˆ‘å·²è®¾ç½®å®Œæˆï¼Œå¼€å§‹ä½¿ç”¨\n                </button>\n                <p style=\"color: #999; margin-top: 15px; font-size: 12px;\">å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·å°è¯•åœ¨ç³»ç»Ÿè®¾ç½®ä¸­å…è®¸ã€Œå®‰è£…æœªçŸ¥æ¥æºåº”ç”¨ã€</p>\n            </div>\n        </div>\n    </div>\n    \n    <div id=\"desktop-view\" class=\"view active\">\n        <div class=\"desktop-header\">\n            <div id=\"desktop-time\">12:00</div>\n            <div id=\"desktop-date\">1æœˆ1æ—¥</div>\n        </div>\n        <div class=\"desktop-top-right\">\n            <button id=\"announcement-btn\">ğŸ“¢</button>\n        </div>\n        <div class=\"desktop-main\">\n            <div class=\"app-dock\" id=\"app-dock\"></div>\n            <div id=\"display-picture-container\"></div>\n        </div>\n    </div>\n    \n    <!-- æ·»åŠ æ­Œæ›²ç•Œé¢ -->\n    <div id=\"settings-view\" class=\"view app-page\">\n        <div class=\"app-header\">\n            <button class=\"back-btn\" data-target=\"desktop-view\">â€¹</button>\n            <h1 id=\"settings-view-title\">æ·»åŠ æ­Œæ›²</h1>\n        </div>\n        <div class=\"app-content\">\n            <div class=\"form-group\">\n                <label>æ­Œæ›²æ ‡é¢˜</label>\n                <input type=\"text\" id=\"song-title-input\" placeholder=\"å°†è‡ªåŠ¨è¯†åˆ«æ–‡ä»¶å\">\n            </div>\n            \n            <div class=\"form-group\">\n                <!-- ä¿®æ”¹2: åˆ é™¤\"åˆ›å»ºæ–‡ä»¶å¤¹\"æŒ‰é’®ï¼Œåªä¿ç•™ä¸‹æ‹‰èœå•ä¸­çš„\"æ–°å»º\"é€‰é¡¹ -->\n                <label>åˆ†ç±»æ–‡ä»¶å¤¹</label>\n                <select id=\"song-folder-select\">\n                    <option value=\"\">æœªåˆ†ç±»</option>\n                    <!-- \"æ–°å»º\"é€‰é¡¹å°†é€šè¿‡JSæ·»åŠ  -->\n                </select>\n            </div>\n            \n            <div class=\"form-group\">\n                <label>å°é¢å›¾ç‰‡ (å¯é€‰)</label>\n                <!-- è£è€€æ‰‹æœºä¸“ç”¨æ–‡ä»¶ä¸Šä¼ æŒ‰é’® -->\n                <div class=\"honor-file-input-container\">\n                    <button type=\"button\" class=\"honor-file-input-button\" id=\"honor-image-btn\">\n                        ğŸ“· é€‰æ‹©å°é¢å›¾ç‰‡\n                    </button>\n                    <input type=\"file\" class=\"honor-file-input-real\" id=\"honor-image-file-input\" accept=\"image/*\">\n                </div>\n                <div style=\"display:flex;align-items:center; margin-top: 10px;\">\n                    <input type=\"file\" id=\"image-file-input\" accept=\"image/*\" style=\"flex-grow:1; display: none;\">\n                    <img id=\"add-image-preview\" class=\"image-preview\" style=\"display:none\">\n                </div>\n                <div id=\"image-size-warning\" class=\"file-size-warning\"></div>\n            </div>\n            \n            <div class=\"form-group\">\n                <label>éŸ³é¢‘æ¥æº</label>\n                <div class=\"source-switcher\">\n                    <label><input type=\"radio\" name=\"audioSource\" value=\"file\" checked> ä¸Šä¼ æ–‡ä»¶</label>\n                    <label><input type=\"radio\" name=\"audioSource\" value=\"url\"> ä½¿ç”¨URL</label>\n                </div>\n                <p style=\"font-size: 12px; color: var(--text-secondary); margin-top: 5px; margin-bottom: 10px;\">å¦‚æœæœºå‹ä¸æ”¯æŒwavï¼Œå¯ä¸Šä¼ url</p>\n                <div id=\"audio-file-group\">\n                    <!-- è£è€€æ‰‹æœºä¸“ç”¨æ–‡ä»¶ä¸Šä¼ æŒ‰é’® -->\n                    <div class=\"honor-file-input-container\">\n                        <button type=\"button\" class=\"honor-file-input-button\" id=\"honor-audio-btn\">\n                            ğŸµ é€‰æ‹©éŸ³é¢‘æ–‡ä»¶\n                        </button>\n                        <input type=\"file\" class=\"honor-file-input-real\" id=\"honor-audio-file-input\" accept=\".mp3,.wav,.m4a,audio/*\">\n                    </div>\n                    <input type=\"file\" id=\"audio-file-input\" accept=\".mp3,.wav,.m4a,audio/*\" style=\"display: none;\">\n                </div>\n                <div id=\"audio-url-group\" class=\"hidden-input\">\n                    <input type=\"text\" id=\"audio-url-input\" placeholder=\"è¾“å…¥ .mp3 æˆ– .wav é“¾æ¥\">\n                </div>\n                <div id=\"audio-size-warning\" class=\"file-size-warning\"></div>\n                <button type=\"button\" class=\"permission-test-btn\" id=\"test-audio-permission\">\n                    æµ‹è¯•éŸ³é¢‘æ–‡ä»¶é€‰æ‹©\n                </button>\n            </div>\n            \n            <div class=\"form-group\">\n                <div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                    <label>å­—å¹•/æ­Œè¯</label>\n                    <button type=\"button\" class=\"import-vtt-btn\" data-target=\"lyric-input\">ğŸ“¥ å¯¼å…¥æ­Œè¯æ–‡ä»¶</button>\n                </div>\n                <textarea id=\"lyric-input\" rows=\"5\" placeholder=\"æ ¼å¼:&#10;00:00:01.000 --> 00:00:04.000&#10;è¿™æ˜¯ç¬¬ä¸€å¥æ­Œè¯...&#10;æˆ–ç›´æ¥ç²˜è´´VTT/SRT/LRCå†…å®¹\"></textarea>\n            </div>\n            \n            <button id=\"save-preset-btn\" class=\"action-button\">ä¿å­˜æ­Œæ›²</button>\n            \n            <!-- è£è€€æ‰‹æœºæƒé™æç¤º -->\n            <div style=\"margin-top: 20px; padding: 15px; background: rgba(255, 152, 0, 0.1); border-radius: 8px; border-left: 4px solid #ff9800;\">\n                <h4 style=\"margin-top: 0; color: #ff9800;\">ğŸ“± è£è€€æ‰‹æœºç”¨æˆ·è¯·æ³¨æ„</h4>\n                <p style=\"font-size: 13px; color: var(--text-secondary); margin-bottom: 10px;\">\n                    å¦‚æœæ— æ³•é€‰æ‹©æ–‡ä»¶ï¼Œè¯·æ£€æŸ¥æ˜¯å¦å·²æˆäºˆåº”ç”¨ã€Œå­˜å‚¨æƒé™ã€ã€‚ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æŸ¥çœ‹è®¾ç½®æ•™ç¨‹ï¼š\n                </p>\n                <button type=\"button\" id=\"show-permission-guide\" style=\"background: #ff9800; color: white; border: none; padding: 8px 15px; border-radius: 4px; font-size: 13px; width: 100%;\">\n                    æŸ¥çœ‹æƒé™è®¾ç½®æ•™ç¨‹\n                </button>\n            </div>\n        </div>\n    </div>\n    \n    <div id=\"edit-song-view\" class=\"view app-page\">\n        <div class=\"app-header\">\n            <button class=\"back-btn\" data-target=\"playlist-view\">â€¹</button>\n            <h1 id=\"edit-view-title\">ç¼–è¾‘æ­Œæ›²</h1>\n        </div>\n        <div class=\"app-content\">\n            <form id=\"edit-song-form\">\n                <div class=\"form-group\">\n                    <label>æ­Œæ›²æ ‡é¢˜</label>\n                    <input type=\"text\" id=\"edit-song-title-input\">\n                </div>\n                <div class=\"form-group\">\n                    <label>åˆ†ç±»æ–‡ä»¶å¤¹</label>\n                    <select id=\"edit-song-folder-select\">\n                        <option value=\"\">æœªåˆ†ç±»</option>\n                    </select>\n                </div>\n                <div class=\"form-group\">\n                    <div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                        <label>å­—å¹•/æ­Œè¯</label>\n                        <button type=\"button\" class=\"import-vtt-btn\" data-target=\"edit-lyric-input\">ğŸ“¥ å¯¼å…¥æ­Œè¯æ–‡ä»¶</button>\n                    </div>\n                    <textarea id=\"edit-lyric-input\" rows=\"5\"></textarea>\n                </div>\n                <div class=\"form-group\">\n                    <label>æ›´æ¢éŸ³é¢‘æ–‡ä»¶ (å¯é€‰)</label>\n                    <!-- è£è€€æ‰‹æœºä¸“ç”¨æ–‡ä»¶ä¸Šä¼ æŒ‰é’® -->\n                    <div class=\"honor-file-input-container\">\n                        <button type=\"button\" class=\"honor-file-input-button\" id=\"honor-edit-audio-btn\">\n                            ğŸµ æ›´æ¢éŸ³é¢‘æ–‡ä»¶\n                        </button>\n                        <input type=\"file\" class=\"honor-file-input-real\" id=\"honor-edit-audio-file-input\" accept=\".mp3,.wav,.m4a,audio/*\">\n                    </div>\n                    <input type=\"file\" id=\"edit-audio-file-input\" accept=\".mp3,.wav,.m4a,audio/*\" style=\"display: none;\">\n                </div>\n                <div class=\"form-group\">\n                    <label>æ›´æ¢å°é¢å›¾ç‰‡ (å¯é€‰)</label>\n                    <!-- è£è€€æ‰‹æœºä¸“ç”¨æ–‡ä»¶ä¸Šä¼ æŒ‰é’® -->\n                    <div class=\"honor-file-input-container\">\n                        <button type=\"button\" class=\"honor-file-input-button\" id=\"honor-edit-image-btn\">\n                            ğŸ“· æ›´æ¢å°é¢å›¾ç‰‡\n                        </button>\n                        <input type=\"file\" class=\"honor-file-input-real\" id=\"honor-edit-image-file-input\" accept=\"image/*\">\n                    </div>\n                    <div style=\"display:flex;align-items:center; margin-top: 10px;\">\n                        <input type=\"file\" id=\"edit-image-file-input\" accept=\"image/*\" style=\"flex-grow:1; display: none;\">\n                        <img id=\"edit-image-preview\" class=\"image-preview\">\n                    </div>\n                </div>\n                <div class=\"form-group\">\n                    <label>ç•Œé¢å¸ƒå±€</label>\n                    <button type=\"button\" id=\"reset-positions-btn\" style=\"background-color: #607D8B; color: white; border: none; padding: 12px; width: 100%; border-radius: 4px;\">â†º é‡ç½®æ‰€æœ‰æ‹–åŠ¨ä½ç½®</button>\n                </div>\n                <button id=\"update-song-btn\" class=\"action-button\" type=\"submit\">ä¿å­˜æ›´æ”¹</button>\n            </form>\n        </div>\n    </div>\n    \n    <!-- æ’­æ”¾åˆ—è¡¨ -->\n    <div id=\"playlist-view\" class=\"view app-page\">\n        <div class=\"app-header\">\n            <button class=\"back-btn\" id=\"playlist-back-btn\" data-target=\"desktop-view\">â€¹</button>\n            <h1 id=\"playlist-view-title\">æ’­æ”¾åˆ—è¡¨</h1>\n            <button id=\"create-folder-btn\" title=\"æ–°å»ºæ–‡ä»¶å¤¹\">+</button>\n        </div>\n        <div class=\"app-content\">\n            <div id=\"folders-grid\" class=\"folder-grid\"></div>\n            <ul id=\"playlist-container\"></ul>\n            <ul id=\"folders-list\" class=\"folder-list\"></ul>\n        </div>\n    </div>\n\n    <div id=\"beautify-view\" class=\"view app-page\">\n        <div class=\"app-header\">\n            <button class=\"back-btn\" data-target=\"desktop-view\">â€¹</button>\n            <h1 id=\"beautify-view-title\">ç¾åŒ–</h1>\n        </div>\n        <div class=\"app-content\">\n            <div class=\"beautify-section\">\n                <h2>ä¸»é¢˜æ¨¡å¼</h2>\n                <div style=\"display:flex;align-items:center;gap:10px;\">\n                    <span>å¤œé—´</span>\n                    <label class=\"switch\">\n                        <input type=\"checkbox\" id=\"theme-switch\">\n                        <span class=\"slider\"></span>\n                    </label>\n                    <span>æ—¥é—´</span>\n                </div>\n            </div>\n            <div class=\"beautify-section\">\n                <h2>åº”ç”¨å®šåˆ¶</h2>\n                <div id=\"app-customize-container\"></div>\n            </div>\n            <div class=\"beautify-section\">\n                <h2>æ’­æ”¾å™¨ç•Œé¢</h2>\n                <div class=\"form-group\">\n                    <label>å…¨å±€èƒŒæ™¯</label>\n                    <!-- è£è€€æ‰‹æœºä¸“ç”¨æ–‡ä»¶ä¸Šä¼ æŒ‰é’® -->\n                    <div class=\"honor-file-input-container\">\n                        <button type=\"button\" class=\"honor-file-input-button\" id=\"honor-player-bg-btn\">\n                            ğŸ–¼ï¸ é€‰æ‹©æ’­æ”¾å™¨èƒŒæ™¯\n                        </button>\n                        <input type=\"file\" class=\"honor-file-input-real\" id=\"honor-player-bg-input\" accept=\"image/*\">\n                    </div>\n                    <input type=\"file\" id=\"player-bg-input\" accept=\"image/*\" style=\"display: none;\">\n                </div>\n                <div class=\"form-group\">\n                    <label>å°é¢å°ºå¯¸ (px)</label>\n                    <div class=\"input-with-button\">\n                        <input type=\"number\" id=\"cover-width-input\" placeholder=\"å®½åº¦\">\n                        <input type=\"number\" id=\"cover-height-input\" placeholder=\"é«˜åº¦\">\n                        <button id=\"save-cover-size-btn\">ä¿å­˜</button>\n                    </div>\n                </div>\n            </div>\n            <div class=\"beautify-section\">\n                <h2>æ¡Œé¢ä¸å­—ä½“</h2>\n                <div class=\"form-group\">\n                    <label>å…¨å±€èƒŒæ™¯</label>\n                    <!-- è£è€€æ‰‹æœºä¸“ç”¨æ–‡ä»¶ä¸Šä¼ æŒ‰é’® -->\n                    <div class=\"honor-file-input-container\">\n                        <button type=\"button\" class=\"honor-file-input-button\" id=\"honor-bg-file-btn\">\n                            ğŸ–¼ï¸ é€‰æ‹©æ¡Œé¢èƒŒæ™¯\n                        </button>\n                        <input type=\"file\" class=\"honor-file-input-real\" id=\"honor-bg-file-input\" accept=\"image/*\">\n                    </div>\n                    <input type=\"file\" id=\"bg-file-input\" accept=\"image/*\" style=\"display: none;\">\n                </div>\n                <div class=\"form-group\">\n                    <label>å±•ç¤ºåŒºå›¾ç‰‡</label>\n                    <!-- è£è€€æ‰‹æœºä¸“ç”¨æ–‡ä»¶ä¸Šä¼ æŒ‰é’® -->\n                    <div class=\"honor-file-input-container\">\n                        <button type=\"button\" class=\"honor-file-input-button\" id=\"honor-dp-file-btn\">\n                            ğŸ–¼ï¸ é€‰æ‹©å±•ç¤ºåŒºå›¾ç‰‡\n                        </button>\n                        <input type=\"file\" class=\"honor-file-input-real\" id=\"honor-dp-file-input\" accept=\"image/*\">\n                    </div>\n                    <input type=\"file\" id=\"dp-file-input\" accept=\"image/*\" style=\"display: none;\">\n                </div>\n                <div class=\"form-group\">\n                    <label>å­—ä½“æ–‡ä»¶</label>\n                    <div class=\"input-with-button\">\n                        <!-- è£è€€æ‰‹æœºä¸“ç”¨æ–‡ä»¶ä¸Šä¼ æŒ‰é’® -->\n                        <div class=\"honor-file-input-container\" style=\"flex-grow: 1;\">\n                            <button type=\"button\" class=\"honor-file-input-button\" id=\"honor-font-file-btn\">\n                                ğŸ”¤ é€‰æ‹©å­—ä½“æ–‡ä»¶\n                            </button>\n                            <input type=\"file\" class=\"honor-file-input-real\" id=\"honor-font-file-input\" accept=\".ttf,.otf,.woff,.woff2\">\n                        </div>\n                        <input type=\"file\" id=\"font-file-input\" accept=\".ttf,.otf,.woff,.woff2\" style=\"display: none;\">\n                        <input type=\"text\" id=\"font-url-input\" placeholder=\"é€‰æ‹©å­—ä½“æ–‡ä»¶æˆ–è¾“å…¥URL\" readonly style=\"display: none;\">\n                        <button id=\"select-font-btn\">é€‰æ‹©æ–‡ä»¶</button>\n                        <button id=\"save-font-btn\">ä¿å­˜</button>\n                    </div>\n                    <p style=\"font-size: 12px; color: var(--text-secondary); margin-top: 5px;\">æ”¯æŒTTFã€OTFã€WOFFã€WOFF2æ ¼å¼</p>\n                </div>\n                <div class=\"form-group\">\n                    <label>å…¨å±€å­—ä½“å¤§å°</label>\n                    <div class=\"font-size-control\">\n                        <input type=\"range\" id=\"font-size-slider\" min=\"12\" max=\"22\" step=\"1\">\n                        <span id=\"font-size-value\">16px</span>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- æ•°æ®ç®¡ç†ç•Œé¢ -->\n    <div id=\"data-view\" class=\"view app-page\">\n        <div class=\"app-header\">\n            <button class=\"back-btn\" data-target=\"desktop-view\">â€¹</button>\n            <h1 id=\"data-view-title\">æ•°æ®ç®¡ç†</h1>\n        </div>\n        <div class=\"app-content\">\n            <p style=\"color: var(--text-secondary); line-height: 1.6; margin-top: 0;\">è¿™é‡Œæ˜¯æ‚¨çš„æ•°æ®ä¸­å¿ƒã€‚æ‚¨å¯ä»¥å°†æ‰€æœ‰æ­Œæ›²ã€ç¾åŒ–è®¾ç½®å’Œä¸ªäººé…ç½®å¯¼å‡ºä¸ºä¸€ä¸ªå•ä¸€çš„ <code>.zip</code> å¤‡ä»½æ–‡ä»¶ã€‚ è¿™ä¸ªæ–‡ä»¶å¯ä»¥åœ¨ä»»ä½•è®¾å¤‡ä¸Šé€šè¿‡\"å¯¼å…¥\"åŠŸèƒ½æ¢å¤æ‚¨çš„æ•´ä¸ªæ’­æ”¾å™¨ï¼Œå®ç°æ— ç¼è¿ç§»å’Œæ•°æ®ä¿æŠ¤ã€‚</p>\n            <div class=\"form-group\">\n                <label>å¯¼å‡º</label>\n                <button id=\"export-btn\" class=\"action-button\">å¯¼å‡ºå…¨éƒ¨æ•°æ®</button>\n            </div>\n            <div class=\"form-group\">\n                <label>å¯¼å…¥</label>\n                <!-- è£è€€æ‰‹æœºä¸“ç”¨æ–‡ä»¶ä¸Šä¼ æŒ‰é’® -->\n                <div class=\"honor-file-input-container\">\n                    <button type=\"button\" class=\"honor-file-input-button\" id=\"honor-import-btn\">\n                        ğŸ“ é€‰æ‹©å¤‡ä»½æ–‡ä»¶å¯¼å…¥\n                    </button>\n                    <input type=\"file\" class=\"honor-file-input-real\" id=\"honor-import-file-input\" accept=\".zip\">\n                </div>\n                <button id=\"import-btn\" class=\"action-button\" style=\"display: none;\">å¯¼å…¥å¤‡ä»½æ–‡ä»¶ (è¦†ç›–)</button>\n                <input type=\"file\" id=\"import-file-input\" accept=\".zip\" style=\"display:none;\">\n            </div>\n            \n            <!-- è£è€€æ‰‹æœºæƒé™æç¤º -->\n            <div style=\"margin-top: 20px; padding: 15px; background: rgba(33, 150, 243, 0.1); border-radius: 8px; border-left: 4px solid #2196F3;\">\n                <h4 style=\"margin-top: 0; color: #2196F3;\">âš ï¸ è£è€€æ‰‹æœºå¯¼å…¥æç¤º</h4>\n                <p style=\"font-size: 13px; color: var(--text-secondary); margin-bottom: 5px;\">\n                    å¦‚æœæ— æ³•é€‰æ‹©å¤‡ä»½æ–‡ä»¶ï¼Œè¯·ç¡®ä¿ï¼š\n                </p>\n                <ul style=\"font-size: 13px; color: var(--text-secondary); padding-left: 20px; margin-bottom: 10px;\">\n                    <li>æ–‡ä»¶ä¿å­˜åœ¨æ‰‹æœºå†…éƒ¨å­˜å‚¨ï¼ˆéSDå¡ï¼‰</li>\n                    <li>æ–‡ä»¶å¤§å°ä¸è¶…è¿‡100MB</li>\n                    <li>å·²æˆäºˆåº”ç”¨å­˜å‚¨æƒé™</li>\n                </ul>\n                <button type=\"button\" id=\"test-import-permission\" class=\"permission-test-btn\" style=\"width: 100%;\">\n                    æµ‹è¯•å¤‡ä»½æ–‡ä»¶é€‰æ‹©\n                </button>\n            </div>\n        </div>\n    </div>\n\n    <div id=\"player-view\" class=\"view\">\n        <div class=\"player-top-bar\">\n            <button class=\"back-btn\" data-target=\"playlist-view\">â€¹</button>\n            <div class=\"right-controls\">\n                <button id=\"set-song-bg-btn\">ğŸ–¼ï¸</button>\n                <button id=\"toggle-color-picker-btn\">ğŸ¨</button>\n                <button id=\"reset-bg-btn\" title=\"é‡ç½®èƒŒæ™¯\">ğŸ—‘ï¸</button>\n                <button id=\"full-lyrics-btn\">ğŸ“œ</button>\n                <button id=\"player-settings-btn\">â‹®</button>\n                <div id=\"player-settings-menu\">\n                    <a id=\"download-song-link\" download>ä¸‹è½½éŸ³é¢‘</a>\n                    <div class=\"speed-control\">\n                        <span>é€Ÿåº¦:</span>\n                        <select id=\"playback-speed\">\n                            <option value=\"0.5\">0.5x</option>\n                            <option value=\"1\" selected>1.0x</option>\n                            <option value=\"1.25\">1.25x</option>\n                            <option value=\"1.5\">1.5x</option>\n                            <option value=\"2.0\">2.0x</option>\n                        </select>\n                    </div>\n                    <div class=\"menu-section\">\n                        <div class=\"menu-section-title\">ç¡çœ å®šæ—¶å™¨</div>\n                        <a href=\"#\" data-time=\"0\">å…³é—­</a>\n                        <a href=\"#\" data-time=\"15\">15 åˆ†é’Ÿå</a>\n                        <a href=\"#\" data-time=\"30\">30 åˆ†é’Ÿå</a>\n                        <a href=\"#\" data-time=\"60\">60 åˆ†é’Ÿå</a>\n                        <a href=\"#\" data-time=\"-1\">å½“å‰æ­Œæ›²æ’­æ”¾å®Œå</a>\n                    </div>\n                     <div class=\"menu-section\">\n                        <a href=\"#\" id=\"toggle-continuous-play\">è¿ç»­æ’­æ”¾: å…³é—­</a>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div id=\"color-picker\"></div>\n        \n        <div id=\"player-content-wrapper\">\n            <div id=\"song-title-box\">Unknown Song</div>\n            <img id=\"album-art\" alt=\"Art\">\n            <div class=\"lyric-bubble\">\n                <p id=\"lyric-display\">...</p>\n            </div>\n        </div>\n\n        <div class=\"player-controls\">\n            <div class=\"progress-bar-container\">\n                <span id=\"current-time\">00:00</span>\n                <input type=\"range\" id=\"progress-bar\" value=\"0\" step=\"1\">\n                <span id=\"duration-time\">00:00</span>\n            </div>\n            <div class=\"main-controls\">\n                <button id=\"prev-btn\">â®</button>\n                <button id=\"play-pause-btn\">â–¶</button>\n                <button id=\"next-btn\">â­</button>\n            </div>\n        </div>\n        \n        <audio id=\"audio-player\" style=\"display: none;\"></audio>\n        <!-- è£è€€æ‰‹æœºä¸“ç”¨æ–‡ä»¶ä¸Šä¼  -->\n        <div style=\"display: none;\">\n            <input type=\"file\" id=\"song-bg-input\" accept=\"image/*\">\n            <input type=\"file\" id=\"vtt-import-input\" accept=\".vtt,.srt,.lrc,.txt\">\n        </div>\n    </div>\n\n    <!-- Full Page Lyrics Modal -->\n    <div id=\"full-lyrics-modal\">\n        <div class=\"full-lyrics-header\">\n            <button class=\"close-lyrics-btn\">Ã—</button>\n        </div>\n        <div class=\"full-lyrics-container\" id=\"full-lyrics-list\">\n            <!-- Lines generated by JS -->\n        </div>\n    </div>\n\n    <div id=\"crop-modal-overlay\" class=\"modal-overlay\"><div id=\"crop-modal-content\"><div id=\"cropper-container\"><img id=\"cropper-image\"></div><div class=\"cropper-buttons\"><button id=\"cancel-crop-btn\">å–æ¶ˆ</button><button id=\"confirm-crop-btn\">è£å‰ª</button></div></div></div>\n    \n    <!-- æ–‡ä»¶ä¸Šä¼ çŠ¶æ€æç¤º -->\n    <div id=\"file-upload-status\" class=\"file-upload-status\"></div>\n\n    <script>\n        // æ£€æµ‹è£è€€æ‰‹æœºå’ŒAndroidè®¾å¤‡\n        const isHonor = /honor/i.test(navigator.userAgent);\n        const isAndroid = /android/i.test(navigator.userAgent);\n        const isHuawei = /huawei/i.test(navigator.userAgent);\n        const isEMUI = /emui/i.test(navigator.userAgent);\n        \n        // ç‰¹åˆ«å¤„ç†è£è€€/Huaweiè®¾å¤‡\n        const isHonorOrHuawei = isHonor || isHuawei || isEMUI;\n        const isAndroidDevice = isAndroid || isHonorOrHuawei;\n        \n        console.log('è®¾å¤‡æ£€æµ‹:', {\n            userAgent: navigator.userAgent,\n            isHonor: isHonor,\n            isAndroid: isAndroid,\n            isHuawei: isHuawei,\n            isEMUI: isEMUI,\n            isHonorOrHuawei: isHonorOrHuawei,\n            isAndroidDevice: isAndroidDevice\n        });\n        \n        document.addEventListener('DOMContentLoaded', () => {\n            // æ˜¾ç¤ºè®¾å¤‡ä¿¡æ¯\n            if (isHonorOrHuawei) {\n                console.log('æ£€æµ‹åˆ°è£è€€/Huaweiè®¾å¤‡ï¼Œå¯ç”¨ç‰¹æ®Šæ–‡ä»¶ä¸Šä¼ å¤„ç†');\n                showUploadStatus('æ£€æµ‹åˆ°è£è€€/Huaweiè®¾å¤‡ï¼Œå·²å¯ç”¨å…¼å®¹æ¨¡å¼');\n            }\n            \n            // åˆå§‹åŒ–æ•°æ®åº“\n            const db = new Dexie('MusicOSDatabase');\n            db.version(5).stores({ \n                songs: '++id, title, folderId', \n                settings: 'key', \n                folders: '++id, name' \n            });\n\n            let currentLyrics = [], cropper, croppedImageBlob = null, lastSaveTime = 0;\n            let sleepTimerId = null, stopAtSongEnd = false, isContinuousPlay = false;\n            let tempObjectURLs = { player: [], playlist: [], beautify: [], config: [] };\n            const defaultCover = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzg4OCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjEwIj48L2NpcmNsZT48cGF0aCBkPSJtMTYgOCAtOCAzIDggMyB6IiAvPjwvZz48L3N2Zz4=';\n            let appConfig = [];\n            const defaultAppConfig = [\n                { id: 'settings', name: 'æ·»åŠ æ­Œæ›²', icon: 'â•', target: 'settings-view' },\n                { id: 'playlist', name: 'æ’­æ”¾åˆ—è¡¨', icon: 'ğŸµ', target: 'playlist-view' },\n                { id: 'beautify', name: 'ç¾åŒ–', icon: 'ğŸ¨', target: 'beautify-view' },\n                { id: 'data', name: 'æ•°æ®ç®¡ç†', icon: 'ğŸ’¾', target: 'data-view' }\n            ];\n            \n            // Folder State\n            let currentFolderId = null; \n\n            // æ˜¾ç¤ºä¸Šä¼ çŠ¶æ€\n            function showUploadStatus(message) {\n                const statusEl = document.getElementById('file-upload-status');\n                if (statusEl) {\n                    statusEl.textContent = message;\n                    statusEl.classList.add('active');\n                    setTimeout(() => {\n                        statusEl.classList.remove('active');\n                    }, 3000);\n                }\n                console.log('ä¸Šä¼ çŠ¶æ€:', message);\n            }\n            \n            // æ˜¾ç¤ºæ–‡ä»¶å¤§å°è­¦å‘Š\n            function showFileSizeWarning(elementId, fileSizeMB, maxSizeMB = 50) {\n                const warningEl = document.getElementById(elementId);\n                if (warningEl) {\n                    if (fileSizeMB > maxSizeMB) {\n                        warningEl.textContent = `âš ï¸ æ–‡ä»¶è¾ƒå¤§ (${fileSizeMB.toFixed(1)}MB)ï¼Œå»ºè®®å‹ç¼©æˆ–é€‰æ‹©å°äº${maxSizeMB}MBçš„æ–‡ä»¶`;\n                        warningEl.classList.add('active');\n                    } else {\n                        warningEl.classList.remove('active');\n                    }\n                }\n            }\n            \n            // è£è€€æ‰‹æœºä¸“ç”¨æ–‡ä»¶ä¸Šä¼ å¤„ç†\n            function initHonorFileUpload() {\n                console.log('åˆå§‹åŒ–è£è€€æ‰‹æœºæ–‡ä»¶ä¸Šä¼ å¤„ç†...');\n                \n                // ç»‘å®šè£è€€æ‰‹æœºä¸“ç”¨æ–‡ä»¶ä¸Šä¼ æŒ‰é’®\n                const honorButtons = {\n                    // æ·»åŠ æ­Œæ›²ç•Œé¢\n                    'honor-image-btn': 'honor-image-file-input',\n                    'honor-audio-btn': 'honor-audio-file-input',\n                    \n                    // ç¼–è¾‘æ­Œæ›²ç•Œé¢\n                    'honor-edit-image-btn': 'honor-edit-image-file-input',\n                    'honor-edit-audio-btn': 'honor-edit-audio-file-input',\n                    \n                    // ç¾åŒ–ç•Œé¢\n                    'honor-player-bg-btn': 'honor-player-bg-input',\n                    'honor-bg-file-btn': 'honor-bg-file-input',\n                    'honor-dp-file-btn': 'honor-dp-file-input',\n                    'honor-font-file-btn': 'honor-font-file-input',\n                    \n                    // æ•°æ®ç®¡ç†ç•Œé¢\n                    'honor-import-btn': 'honor-import-file-input'\n                };\n                \n                // ä¸ºæ¯ä¸ªè£è€€æŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶\n                Object.keys(honorButtons).forEach(buttonId => {\n                    const button = document.getElementById(buttonId);\n                    const inputId = honorButtons[buttonId];\n                    const input = document.getElementById(inputId);\n                    \n                    if (button && input) {\n                        button.addEventListener('click', function(e) {\n                            e.preventDefault();\n                            e.stopPropagation();\n                            console.log('è£è€€æ–‡ä»¶ä¸Šä¼ æŒ‰é’®è¢«ç‚¹å‡»:', buttonId);\n                            \n                            // å°è¯•å¤šç§æ–¹å¼è§¦å‘æ–‡ä»¶é€‰æ‹©\n                            try {\n                                // æ–¹æ³•1: ç›´æ¥è°ƒç”¨click\n                                input.click();\n                                \n                                // æ–¹æ³•2: å¦‚æœæ–¹æ³•1å¤±è´¥ï¼Œåˆ›å»ºæ–°çš„inputå…ƒç´ \n                                setTimeout(() => {\n                                    if (!input.files || input.files.length === 0) {\n                                        console.log('æ–¹æ³•1å¯èƒ½å¤±è´¥ï¼Œå°è¯•æ–¹æ³•2');\n                                        const tempInput = document.createElement('input');\n                                        tempInput.type = 'file';\n                                        tempInput.accept = input.accept;\n                                        tempInput.style.display = 'none';\n                                        document.body.appendChild(tempInput);\n                                        \n                                        tempInput.addEventListener('change', function() {\n                                            // å°†æ–‡ä»¶ä¼ é€’ç»™åŸå§‹input\n                                            const dataTransfer = new DataTransfer();\n                                            for (let i = 0; i < this.files.length; i++) {\n                                                dataTransfer.items.add(this.files[i]);\n                                            }\n                                            input.files = dataTransfer.files;\n                                            \n                                            // è§¦å‘changeäº‹ä»¶\n                                            const event = new Event('change', { bubbles: true });\n                                            input.dispatchEvent(event);\n                                            \n                                            document.body.removeChild(tempInput);\n                                        });\n                                        \n                                        tempInput.click();\n                                    }\n                                }, 100);\n                                \n                                showUploadStatus('è¯·é€‰æ‹©æ–‡ä»¶...');\n                            } catch (error) {\n                                console.error('æ–‡ä»¶é€‰æ‹©å¤±è´¥:', error);\n                                showUploadStatus('æ–‡ä»¶é€‰æ‹©å¤±è´¥ï¼Œè¯·æ£€æŸ¥æƒé™');\n                                \n                                // æ˜¾ç¤ºæƒé™å¼•å¯¼\n                                document.getElementById('honor-permission-guide').classList.add('active');\n                            }\n                        });\n                        \n                        // ç›‘å¬æ–‡ä»¶é€‰æ‹©\n                        input.addEventListener('change', function(e) {\n                            if (this.files && this.files.length > 0) {\n                                const file = this.files[0];\n                                console.log('æ–‡ä»¶é€‰æ‹©æˆåŠŸ:', file.name, 'å¤§å°:', (file.size / 1024 / 1024).toFixed(2) + 'MB');\n                                showUploadStatus(`å·²é€‰æ‹©: ${file.name}`);\n                                \n                                // æ ¹æ®inputç±»å‹å¤„ç†æ–‡ä»¶\n                                handleHonorFileSelection(inputId, file);\n                            }\n                        });\n                    }\n                });\n                \n                // æµ‹è¯•æƒé™æŒ‰é’®\n                document.getElementById('test-audio-permission')?.addEventListener('click', function() {\n                    testFilePermission('audio');\n                });\n                \n                document.getElementById('test-import-permission')?.addEventListener('click', function() {\n                    testFilePermission('zip');\n                });\n                \n                // æ˜¾ç¤ºæƒé™å¼•å¯¼æŒ‰é’®\n                document.getElementById('show-permission-guide')?.addEventListener('click', function() {\n                    document.getElementById('honor-permission-guide').classList.add('active');\n                });\n                \n                // å…³é—­æƒé™å¼•å¯¼\n                document.getElementById('close-permission-guide')?.addEventListener('click', function() {\n                    document.getElementById('honor-permission-guide').classList.remove('active');\n                });\n            }\n            \n            // å¤„ç†è£è€€æ‰‹æœºæ–‡ä»¶é€‰æ‹©\n            function handleHonorFileSelection(inputId, file) {\n                console.log('å¤„ç†è£è€€æ–‡ä»¶:', inputId, file.name);\n                \n                // æ ¹æ®inputIdæ˜ å°„åˆ°åŸå§‹input\n                const inputMap = {\n                    'honor-image-file-input': 'image-file-input',\n                    'honor-audio-file-input': 'audio-file-input',\n                    'honor-edit-image-file-input': 'edit-image-file-input',\n                    'honor-edit-audio-file-input': 'edit-audio-file-input',\n                    'honor-player-bg-input': 'player-bg-input',\n                    'honor-bg-file-input': 'bg-file-input',\n                    'honor-dp-file-input': 'dp-file-input',\n                    'honor-font-file-input': 'font-file-input',\n                    'honor-import-file-input': 'import-file-input'\n                };\n                \n                const originalInputId = inputMap[inputId];\n                if (originalInputId) {\n                    const originalInput = document.getElementById(originalInputId);\n                    if (originalInput) {\n                        // åˆ›å»ºDataTransferå¯¹è±¡æ¥è®¾ç½®æ–‡ä»¶\n                        const dataTransfer = new DataTransfer();\n                        dataTransfer.items.add(file);\n                        originalInput.files = dataTransfer.files;\n                        \n                        // è§¦å‘changeäº‹ä»¶\n                        const event = new Event('change', { bubbles: true });\n                        originalInput.dispatchEvent(event);\n                        \n                        // ç‰¹æ®Šå¤„ç†ï¼šéŸ³é¢‘æ–‡ä»¶è‡ªåŠ¨å¡«å……æ ‡é¢˜\n                        if (inputId === 'honor-audio-file-input' && file.name) {\n                            const titleInput = document.getElementById('song-title-input');\n                            if (titleInput && (!titleInput.value || titleInput.value === '')) {\n                                const fileName = file.name.replace(/\\.[^/.]+$/, \"\");\n                                titleInput.value = fileName;\n                            }\n                        }\n                        \n                        // æ˜¾ç¤ºæ–‡ä»¶å¤§å°è­¦å‘Š\n                        const fileSizeMB = file.size / 1024 / 1024;\n                        if (inputId.includes('audio')) {\n                            showFileSizeWarning('audio-size-warning', fileSizeMB, 100);\n                        } else if (inputId.includes('image')) {\n                            showFileSizeWarning('image-size-warning', fileSizeMB, 20);\n                        }\n                    }\n                }\n            }\n            \n            // æµ‹è¯•æ–‡ä»¶æƒé™\n            function testFilePermission(type) {\n                const acceptMap = {\n                    'audio': '.mp3,.wav,.m4a,audio/*',\n                    'image': 'image/*',\n                    'zip': '.zip',\n                    'all': '*/*'\n                };\n                \n                const accept = acceptMap[type] || '*/*';\n                const testInput = document.createElement('input');\n                testInput.type = 'file';\n                testInput.accept = accept;\n                testInput.style.display = 'none';\n                \n                document.body.appendChild(testInput);\n                \n                let permissionGranted = false;\n                const timeout = setTimeout(() => {\n                    if (!permissionGranted) {\n                        showUploadStatus('æ–‡ä»¶é€‰æ‹©è¶…æ—¶ï¼Œå¯èƒ½æ²¡æœ‰æƒé™');\n                        document.getElementById('honor-permission-guide').classList.add('active');\n                    }\n                    document.body.removeChild(testInput);\n                }, 3000);\n                \n                testInput.addEventListener('change', function() {\n                    permissionGranted = true;\n                    clearTimeout(timeout);\n                    \n                    if (this.files && this.files.length > 0) {\n                        showUploadStatus('æƒé™æµ‹è¯•æˆåŠŸï¼å¯ä»¥æ­£å¸¸é€‰æ‹©æ–‡ä»¶');\n                    } else {\n                        showUploadStatus('æƒé™æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥è®¾ç½®');\n                    }\n                    \n                    setTimeout(() => {\n                        document.body.removeChild(testInput);\n                    }, 100);\n                });\n                \n                try {\n                    testInput.click();\n                    showUploadStatus('æ­£åœ¨æµ‹è¯•æ–‡ä»¶æƒé™...');\n                } catch (error) {\n                    console.error('æƒé™æµ‹è¯•å¤±è´¥:', error);\n                    showUploadStatus('æƒé™æµ‹è¯•å¤±è´¥ï¼Œè¯·æŸ¥çœ‹è®¾ç½®æ•™ç¨‹');\n                    document.getElementById('honor-permission-guide').classList.add('active');\n                    document.body.removeChild(testInput);\n                }\n            }\n            \n            // åˆå§‹åŒ–è£è€€æ‰‹æœºæ–‡ä»¶ä¸Šä¼ ï¼ˆå¦‚æœæ˜¯è£è€€/Huaweiè®¾å¤‡ï¼‰\n            if (isHonorOrHuawei) {\n                setTimeout(() => {\n                    initHonorFileUpload();\n                }, 1000);\n            }\n\n            function revokeURLs(key) { if (tempObjectURLs[key]) { tempObjectURLs[key].forEach(url => URL.revokeObjectURL(url)); tempObjectURLs[key] = []; } }\n            function navigateTo(viewId) { document.querySelectorAll('.view').forEach(v => v.classList.toggle('active', v.id === viewId)); }\n            \n            function setupNavigation() {\n                document.body.addEventListener('click', e => {\n                    const appIcon = e.target.closest('.app-icon');\n                    const backBtn = e.target.closest('.back-btn, #player-back-btn');\n                    const announcementBtn = e.target.closest('#announcement-btn');\n                    const closeModalBtn = e.target.closest('#close-modal-btn');\n                    const sponsorBtn = e.target.closest('#sponsor-btn');\n                    const closeSponsorBtn = e.target.closest('.close-sponsor-btn');\n\n                    if (appIcon) { \n                        e.preventDefault(); \n                        const target = appIcon.dataset.target;\n                        navigateTo(target); \n                        if (target === 'beautify-view') loadBeautifySettings(); \n                        if (target === 'settings-view') {\n                            loadFoldersIntoSelect('song-folder-select'); \n                            document.getElementById('song-title-input').value = '';\n                        }\n                        if (target === 'playlist-view') {\n                            currentFolderId = null;\n                            renderPlaylist();\n                        }\n                    }\n                    if (backBtn) { \n                        const target = backBtn.dataset.target;\n                        if (backBtn.id === 'playlist-back-btn') {\n                            if (currentFolderId !== null) {\n                                currentFolderId = null;\n                                renderPlaylist();\n                                return;\n                            }\n                        }\n\n                        if (document.getElementById('player-view').classList.contains('active')) { \n                            document.getElementById('audio-player').pause(); \n                        }\n                        navigateTo(target); \n                    }\n                    if (announcementBtn) { /* å…¬å‘Šå·²ç§»é™¤ */ }\n                    if (closeModalBtn) { e.target.closest('.modal-overlay').style.display = 'none'; }\n                });\n            }\n\n            function updateClock() {\n                const timeEl = document.getElementById('desktop-time'), dateEl = document.getElementById('desktop-date'), now = new Date();\n                timeEl.textContent = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', hour12: false });\n                dateEl.textContent = now.toLocaleDateString('zh-CN', { month: 'long', day: 'numeric', weekday: 'long' });\n            }\n\n            async function renderUI() {\n                revokeURLs('config');\n                const [dbAppConfig, desktopBg, displayPicture, fontUrl, theme, lyricColor, fontSize] = await db.settings.bulkGet(['appConfig', 'desktopBg', 'displayPicture', 'fontUrl', 'theme', 'lyricColor', 'fontSize']);\n                appConfig = dbAppConfig?.value || JSON.parse(JSON.stringify(defaultAppConfig));\n                const currentFontSize = fontSize?.value || '16';\n                document.documentElement.style.setProperty('--global-font-size', `${currentFontSize}px`);\n                document.body.classList.toggle('light-mode', theme?.value === 'light');\n                const appDock = document.getElementById('app-dock'); appDock.innerHTML = '';\n                appConfig.forEach(app => {\n                    let iconContent = app.icon;\n                    if (app.icon instanceof Blob) { const url = URL.createObjectURL(app.icon); tempObjectURLs.config.push(url); iconContent = `<img src=\"${url}\" style=\"width:100%;height:100%;object-fit:cover;border-radius:15px;\">`; }\n                    appDock.innerHTML += `<a href=\"#\" class=\"app-icon\" data-target=\"${app.target}\"><div class=\"icon-bg\">${iconContent}</div><span>${app.name}</span></a>`;\n                    const titleEl = document.getElementById(`${app.id}-view-title`); if (titleEl) titleEl.textContent = app.name;\n                });\n                const desktopView = document.getElementById('desktop-view'), dpContainer = document.getElementById('display-picture-container');\n                if (desktopBg?.value) { const url = URL.createObjectURL(desktopBg.value); tempObjectURLs.config.push(url); desktopView.style.backgroundImage = `url(${url})`; } else { desktopView.style.backgroundImage = ''; }\n                if (displayPicture?.value) { const url = URL.createObjectURL(displayPicture.value); tempObjectURLs.config.push(url); dpContainer.style.backgroundImage = `url(${url})`; } else { dpContainer.style.backgroundImage = ''; }\n                const fontStyleEl = document.getElementById('dynamic-font-style'); if(fontStyleEl) fontStyleEl.remove();\n                if (fontUrl?.value) { \n                    const style = document.createElement('style'); \n                    style.id = 'dynamic-font-style'; \n                    if (fontUrl.value.startsWith('blob:')) {\n                        style.innerHTML = `@font-face{font-family:'CustomFont';src:url('${fontUrl.value}');}:root{--global-font:'CustomFont',sans-serif;}`;\n                    } else {\n                        style.innerHTML = `@font-face{font-family:'CustomFont';src:url('${fontUrl.value}');}:root{--global-font:'CustomFont',sans-serif;}`;\n                    }\n                    document.head.appendChild(style); \n                }\n                document.documentElement.style.setProperty('--lyric-color', lyricColor?.value || '#ffffff');\n            }\n\n            async function loadBeautifySettings() {\n                revokeURLs('beautify');\n                const [fontUrl, theme, coverWidth, coverHeight, fontSize] = await db.settings.bulkGet(['fontUrl', 'theme', 'coverWidth', 'coverHeight', 'fontSize']);\n                const container = document.getElementById('app-customize-container'); container.innerHTML = '';\n                appConfig.forEach((app, index) => {\n                    let iconUrl = '';\n                    if (app.icon instanceof Blob) { iconUrl = URL.createObjectURL(app.icon); tempObjectURLs.beautify.push(iconUrl); } \n                    else if (typeof app.icon === 'string' && !app.icon.includes(':')) { iconUrl = ''; } \n                    else { iconUrl = app.icon; }\n                    container.innerHTML += `<div class=\"app-customize-row\"><img id=\"preview-icon-${index}\" class=\"preview-icon\" src=\"${iconUrl}\" alt=\"icon\"><input type=\"text\" value=\"${app.name}\" data-index=\"${index}\" class=\"app-name-input\"><button class=\"select-file-btn\" data-index=\"${index}\">é€‰æ‹©æ–‡ä»¶</button><input type=\"file\" id=\"icon-input-${index}\" accept=\"image/*\" data-index=\"${index}\" style=\"display:none;\"></div>`;\n                });\n                document.getElementById('theme-switch').checked = theme?.value === 'light';\n                \n                const fontUrlInput = document.getElementById('font-url-input');\n                if (fontUrl?.value) {\n                    if (fontUrl.value.startsWith('blob:')) {\n                        fontUrlInput.value = 'å·²ä¸Šä¼ å­—ä½“æ–‡ä»¶';\n                    } else {\n                        fontUrlInput.value = fontUrl.value;\n                    }\n                } else {\n                    fontUrlInput.value = '';\n                }\n                \n                document.getElementById('cover-width-input').value = coverWidth?.value || '';\n                document.getElementById('cover-height-input').value = coverHeight?.value || '';\n                const fontSizeSlider = document.getElementById('font-size-slider'), fontSizeValue = document.getElementById('font-size-value'), currentFontSize = fontSize?.value || '16';\n                fontSizeSlider.value = currentFontSize; fontSizeValue.textContent = `${currentFontSize}px`;\n            }\n\n            const beautifyView = document.getElementById('beautify-view');\n            beautifyView.addEventListener('change', async (e) => {\n                const el = e.target;\n                const index = el.dataset.index;\n                if (el.matches('input[type=file]')) {\n                    const file = el.files[0]; if (!file) return;\n                    if (el.id === `icon-input-${index}`) { appConfig[index].icon = file; await db.settings.put({ key: 'appConfig', value: appConfig }); document.getElementById(`preview-icon-${index}`).src = URL.createObjectURL(file); renderUI(); }\n                    else if (el.id === 'player-bg-input') await db.settings.put({ key: 'playerBg', value: file });\n                    else if (el.id === 'bg-file-input') { await db.settings.put({ key: 'desktopBg', value: file }); renderUI(); }\n                    else if (el.id === 'dp-file-input') { await db.settings.put({ key: 'displayPicture', value: file }); renderUI(); }\n                } else if (el.id === 'theme-switch') { const theme = el.checked ? 'light' : 'dark'; await db.settings.put({ key: 'theme', value: theme }); renderUI(); }\n            });\n            beautifyView.addEventListener('focusout', async (e) => {\n                const el = e.target; if (el.classList.contains('app-name-input')) { appConfig[el.dataset.index].name = el.value; await db.settings.put({ key: 'appConfig', value: appConfig }); renderUI(); }\n            });\n            beautifyView.addEventListener('click', async (e) => {\n                const el = e.target;\n                if (el.classList.contains('select-file-btn')) { \n                    // å¦‚æœæ˜¯è£è€€æ‰‹æœºï¼Œä½¿ç”¨ä¸“ç”¨æŒ‰é’®\n                    if (isHonorOrHuawei) {\n                        const index = el.dataset.index;\n                        const honorInput = document.getElementById(`honor-icon-input-${index}`);\n                        if (honorInput) {\n                            honorInput.click();\n                        } else {\n                            document.getElementById(`icon-input-${index}`).click();\n                        }\n                    } else {\n                        document.getElementById(`icon-input-${el.dataset.index}`).click(); \n                    }\n                }\n                else if (el.id === 'select-font-btn') { \n                    if (isHonorOrHuawei) {\n                        document.getElementById('honor-font-file-btn').click();\n                    } else {\n                        document.getElementById('font-file-input').click(); \n                    }\n                }\n                else if (el.id === 'save-font-btn') { \n                    const fontFileInput = document.getElementById('font-file-input');\n                    const fontUrlInput = document.getElementById('font-url-input');\n                    \n                    if (fontFileInput.files.length > 0) {\n                        const fontFile = fontFileInput.files[0];\n                        const fontUrl = URL.createObjectURL(fontFile);\n                        await db.settings.put({ key: 'fontUrl', value: fontUrl });\n                        fontUrlInput.value = 'å·²ä¸Šä¼ å­—ä½“æ–‡ä»¶';\n                        await renderUI();\n                        showUploadStatus('å­—ä½“æ–‡ä»¶å·²ä¿å­˜ï¼');\n                    } else if (fontUrlInput.value && fontUrlInput.value !== 'å·²ä¸Šä¼ å­—ä½“æ–‡ä»¶') {\n                        await db.settings.put({ key: 'fontUrl', value: fontUrlInput.value });\n                        await renderUI();\n                        showUploadStatus('å­—ä½“URLå·²ä¿å­˜ï¼');\n                    } else {\n                        showUploadStatus('è¯·å…ˆé€‰æ‹©å­—ä½“æ–‡ä»¶æˆ–è¾“å…¥å­—ä½“URLï¼');\n                    }\n                }\n                else if (el.id === 'save-cover-size-btn') { const width = document.getElementById('cover-width-input').value, height = document.getElementById('cover-height-input').value; await db.settings.bulkPut([{ key: 'coverWidth', value: width }, { key: 'coverHeight', value: height }]); showUploadStatus('å°é¢å°ºå¯¸å·²ä¿å­˜ï¼'); }\n            });\n            beautifyView.addEventListener('input', async (e) => {\n                if (e.target.id === 'font-size-slider') {\n                    const slider = e.target, value = slider.value;\n                    document.getElementById('font-size-value').textContent = `${value}px`;\n                    document.documentElement.style.setProperty('--global-font-size', `${value}px`);\n                    await db.settings.put({ key: 'fontSize', value: value });\n                }\n            });\n            \n            // --- Playlist & Folder Logic ---\n\n            async function renderPlaylist() {\n                revokeURLs('playlist');\n                const songContainer = document.getElementById('playlist-container'); \n                const folderGrid = document.getElementById('folders-grid');\n                const folderList = document.getElementById('folders-list');\n                const createFolderBtn = document.getElementById('create-folder-btn');\n                const backBtn = document.getElementById('playlist-back-btn');\n                const title = document.getElementById('playlist-view-title');\n\n                if (currentFolderId === null) {\n                    songContainer.style.display = 'none';\n                    folderGrid.style.display = 'none';\n                    folderList.style.display = 'block';\n                    createFolderBtn.style.display = 'block';\n                    backBtn.dataset.target = 'desktop-view';\n                    title.textContent = 'æ’­æ”¾åˆ—è¡¨';\n\n                    folderList.innerHTML = '';\n                    \n                    const allSongs = await db.songs.toArray();\n                    const looseSongs = allSongs.filter(s => !s.folderId);\n                    \n                    if (looseSongs.length > 0) {\n                        const li = document.createElement('li');\n                        li.className = 'folder-list-item';\n                        li.innerHTML = `\n                            <div class=\"folder-list-icon\">ğŸ“</div>\n                            <div class=\"folder-list-info\">\n                                <div class=\"folder-list-name\">æœªåˆ†ç±»</div>\n                                <div class=\"folder-list-count\">${looseSongs.length} é¦–</div>\n                            </div>\n                        `;\n                        li.onclick = () => { currentFolderId = 'uncategorized'; renderPlaylist(); };\n                        folderList.appendChild(li);\n                    }\n\n                    const folders = await db.folders.toArray();\n                    for (const folder of folders) {\n                        const count = await db.songs.where('folderId').equals(folder.id.toString()).count();\n                        const li = document.createElement('li');\n                        li.className = 'folder-list-item';\n                        li.innerHTML = `\n                            <div class=\"folder-list-icon\">ğŸ“</div>\n                            <div class=\"folder-list-info\">\n                                <div class=\"folder-list-name\">${folder.name}</div>\n                                <div class=\"folder-list-count\">${count} é¦–</div>\n                            </div>\n                            <!-- ä¿®æ”¹3: åœ¨é‡å‘½åæŒ‰é’®æ—è¾¹æ·»åŠ åˆ é™¤æŒ‰é’® -->\n                            <div class=\"folder-list-actions\">\n                                <button class=\"folder-rename-btn\" data-id=\"${folder.id}\" title=\"é‡å‘½å\">âœï¸</button>\n                                <button class=\"folder-delete-list-btn\" data-id=\"${folder.id}\" title=\"åˆ é™¤æ–‡ä»¶å¤¹\">ğŸ—‘ï¸</button>\n                            </div>\n                        `;\n                        \n                        li.onclick = (e) => {\n                            if(!e.target.classList.contains('folder-rename-btn') && !e.target.classList.contains('folder-delete-list-btn')) {\n                                currentFolderId = folder.id.toString(); \n                                renderPlaylist();\n                            }\n                        };\n                        \n                        const renameBtn = li.querySelector('.folder-rename-btn');\n                        renameBtn.onclick = async (e) => {\n                            e.stopPropagation();\n                            const newName = prompt(\"é‡å‘½åæ–‡ä»¶å¤¹:\", folder.name);\n                            if (newName && newName !== folder.name) {\n                                await db.folders.update(folder.id, { name: newName });\n                                renderPlaylist();\n                            }\n                        };\n                        \n                        // ä¿®æ”¹3: æ·»åŠ åˆ é™¤æ–‡ä»¶å¤¹åŠŸèƒ½\n                        const deleteBtn = li.querySelector('.folder-delete-list-btn');\n                        deleteBtn.onclick = async (e) => {\n                            e.stopPropagation();\n                            if(confirm('ç¡®å®šåˆ é™¤æ­¤æ–‡ä»¶å¤¹å—ï¼Ÿé‡Œé¢çš„æ­Œæ›²å°†å˜ä¸ºæœªåˆ†ç±»ã€‚')) {\n                                const folderId = e.target.dataset.id;\n                                await db.folders.delete(parseInt(folderId));\n                                await db.songs.where('folderId').equals(folderId).modify({folderId: ''});\n                                renderPlaylist();\n                            }\n                        };\n                        \n                        folderList.appendChild(li);\n                    }\n\n                } else {\n                    songContainer.style.display = 'block';\n                    folderGrid.style.display = 'none';\n                    folderList.style.display = 'none';\n                    createFolderBtn.style.display = 'none';\n                    \n                    let songs = [];\n                    if (currentFolderId === 'uncategorized') {\n                        title.textContent = 'æœªåˆ†ç±»';\n                        const allSongs = await db.songs.toArray();\n                        songs = allSongs.filter(s => !s.folderId);\n                    } else {\n                        const folder = await db.folders.get(parseInt(currentFolderId));\n                        title.textContent = folder ? folder.name : 'æœªçŸ¥æ–‡ä»¶å¤¹';\n                        songs = await db.songs.where('folderId').equals(currentFolderId).toArray();\n                    }\n\n                    songContainer.innerHTML = '';\n                    if (songs.length === 0) { songContainer.innerHTML = '<li style=\"padding: 20px; text-align: center; color: var(--text-secondary);\">æš‚æ— æ­Œæ›²...</li>'; return; }\n                    \n                    songs.forEach(song => { \n                        const li = document.createElement('li'); li.className = 'playlist-item'; \n                        let imageUrl = defaultCover; \n                        if (song.imageFile) { imageUrl = URL.createObjectURL(song.imageFile); tempObjectURLs.playlist.push(imageUrl); } \n                        li.innerHTML = `<img src=\"${imageUrl}\" alt=\"${song.title}\"><div class=\"song-info\" data-song-id=\"${song.id}\"><span class=\"song-title\">${song.title}</span></div><div class=\"actions\"><button class=\"edit-song-btn\" data-song-id=\"${song.id}\">âœï¸</button><button class=\"delete-song-btn\" data-song-id=\"${song.id}\">ğŸ—‘ï¸</button></div>`; \n                        songContainer.appendChild(li); \n                    });\n                }\n            }\n\n            document.getElementById('create-folder-btn').addEventListener('click', async () => {\n                const name = prompt(\"è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°ï¼š\");\n                if (name) {\n                    await db.folders.add({ name: name });\n                    renderPlaylist();\n                    loadFoldersIntoSelect('song-folder-select');\n                }\n            });\n\n            // ä¿®æ”¹2: ç®€åŒ–æ–‡ä»¶å¤¹åŠ è½½å‡½æ•°ï¼Œåªä¿ç•™\"æ–°å»º\"é€‰é¡¹\n            async function loadFoldersIntoSelect(selectId, selectedValue = '', showNewOption = true) {\n                const select = document.getElementById(selectId);\n                const currentHTML = select.innerHTML;\n                select.innerHTML = '<option value=\"\">æœªåˆ†ç±»</option>';\n                \n                const folders = await db.folders.toArray();\n                folders.forEach(f => {\n                    const option = document.createElement('option');\n                    option.value = f.id;\n                    option.textContent = f.name;\n                    if(f.id.toString() === selectedValue) option.selected = true;\n                    select.appendChild(option);\n                });\n                \n                // æ·»åŠ æ–°å»ºæ–‡ä»¶å¤¹é€‰é¡¹\n                if (showNewOption && selectId === 'song-folder-select') {\n                    const newOption = document.createElement('option');\n                    newOption.value = 'new';\n                    newOption.textContent = 'æ–°å»º';\n                    // ä¿®æ”¹2: ç§»é™¤ç‰¹æ®Šæ ·å¼ï¼Œä½¿ç”¨é»˜è®¤æ ·å¼\n                    select.appendChild(newOption);\n                }\n                \n                // å¦‚æœæ˜¯ç¼–è¾‘ç•Œé¢ï¼Œéœ€è¦é‡æ–°è®¾ç½®é€‰ä¸­å€¼\n                if (selectedValue && selectedValue !== 'new') {\n                    select.value = selectedValue;\n                }\n            }\n\n            // ä¿®æ”¹2: ç›‘å¬æ–‡ä»¶å¤¹é€‰æ‹©å˜åŒ–\n            document.getElementById('song-folder-select').addEventListener('change', function() {\n                if (this.value === 'new') {\n                    const folderName = prompt(\"è¯·è¾“å…¥æ–°æ–‡ä»¶å¤¹åç§°ï¼š\");\n                    if (folderName) {\n                        // å¼‚æ­¥åˆ›å»ºæ–‡ä»¶å¤¹å¹¶æ›´æ–°ä¸‹æ‹‰æ¡†\n                        db.folders.add({ name: folderName }).then(async (id) => {\n                            await loadFoldersIntoSelect('song-folder-select', id.toString());\n                        });\n                    } else {\n                        this.value = '';\n                    }\n                }\n            });\n\n            // Playlist Item Actions\n            document.getElementById('playlist-container').addEventListener('click', e => {\n                const songInfo = e.target.closest('.song-info'), deleteBtn = e.target.closest('.delete-song-btn'), editBtn = e.target.closest('.edit-song-btn');\n                if (songInfo) startPlayback(parseInt(songInfo.dataset.songId));\n                if (deleteBtn) deleteSong(parseInt(deleteBtn.dataset.songId));\n                if (editBtn) openEditView(parseInt(editBtn.dataset.songId));\n            });\n            async function deleteSong(id) { if (confirm('ç¡®å®šè¦åˆ é™¤è¿™é¦–æ­Œæ›²å—ï¼Ÿ')) { await db.songs.delete(id); renderPlaylist(); } }\n            \n            document.querySelectorAll('input[name=\"audioSource\"]').forEach(radio => {\n                radio.addEventListener('change', () => {\n                    document.getElementById('audio-file-group').classList.toggle('hidden-input', radio.value !== 'file');\n                    document.getElementById('audio-url-group').classList.toggle('hidden-input', radio.value !== 'url');\n                });\n            });\n\n            // VTT Import Logic\n            const vttInput = document.getElementById('vtt-import-input');\n            let vttTargetId = '';\n            document.querySelectorAll('.import-vtt-btn').forEach(btn => {\n                btn.addEventListener('click', (e) => {\n                    vttTargetId = e.target.dataset.target;\n                    // å¦‚æœæ˜¯è£è€€æ‰‹æœºï¼Œä½¿ç”¨ç‰¹æ®Šæ–¹æ³•\n                    if (isHonorOrHuawei) {\n                        const tempInput = document.createElement('input');\n                        tempInput.type = 'file';\n                        tempInput.accept = '.vtt,.srt,.lrc,.txt';\n                        tempInput.style.display = 'none';\n                        \n                        tempInput.addEventListener('change', function() {\n                            if (this.files && this.files.length > 0) {\n                                const file = this.files[0];\n                                const reader = new FileReader();\n                                reader.onload = (ev) => {\n                                    const content = ev.target.result;\n                                    const target = document.getElementById(vttTargetId);\n                                    if (target) {\n                                        const fileName = file.name.toLowerCase();\n                                        let parsedLyrics = content;\n                                        \n                                        if (fileName.endsWith('.srt')) {\n                                            parsedLyrics = convertSrtToVtt(content);\n                                        } else if (fileName.endsWith('.lrc')) {\n                                            parsedLyrics = content;\n                                        } else if (fileName.endsWith('.vtt')) {\n                                            parsedLyrics = content;\n                                        } else {\n                                            if (content.includes('-->') || content.includes('WEBVTT')) {\n                                                parsedLyrics = content;\n                                            } else if (content.includes('\\n\\n') && content.match(/\\d+\\s*\\n\\d{2}:\\d{2}:\\d{2},\\d{3}/)) {\n                                                parsedLyrics = convertSrtToVtt(content);\n                                            } else if (content.includes('[') && content.includes(']')) {\n                                                parsedLyrics = content;\n                                            }\n                                        }\n                                        \n                                        target.value = parsedLyrics;\n                                        showUploadStatus(`å·²å¯¼å…¥æ­Œè¯æ–‡ä»¶: ${file.name}`);\n                                    }\n                                };\n                                reader.readAsText(file, 'utf-8');\n                            }\n                            document.body.removeChild(tempInput);\n                        });\n                        \n                        document.body.appendChild(tempInput);\n                        tempInput.click();\n                    } else {\n                        vttInput.click();\n                    }\n                });\n            });\n\n            vttInput.addEventListener('change', async (e) => {\n                const file = e.target.files[0];\n                if (!file) return;\n                \n                const reader = new FileReader();\n                reader.onload = (ev) => {\n                    const content = ev.target.result;\n                    const target = document.getElementById(vttTargetId);\n                    if (target) {\n                        const fileName = file.name.toLowerCase();\n                        let parsedLyrics = content;\n                        \n                        if (fileName.endsWith('.srt')) {\n                            parsedLyrics = convertSrtToVtt(content);\n                        } else if (fileName.endsWith('.lrc')) {\n                            parsedLyrics = content; // LRCæ ¼å¼ä¿æŒåŸæ ·\n                        } else if (fileName.endsWith('.vtt')) {\n                            parsedLyrics = content;\n                        } else {\n                            if (content.includes('-->') || content.includes('WEBVTT')) {\n                                parsedLyrics = content;\n                            } else if (content.includes('\\n\\n') && content.match(/\\d+\\s*\\n\\d{2}:\\d{2}:\\d{2},\\d{3}/)) {\n                                parsedLyrics = convertSrtToVtt(content);\n                            } else if (content.includes('[') && content.includes(']')) {\n                                // LRCæ ¼å¼ä¿æŒåŸæ ·\n                                parsedLyrics = content;\n                            }\n                        }\n                        \n                        target.value = parsedLyrics;\n                    }\n                };\n                reader.readAsText(file, 'utf-8');\n                e.target.value = ''; // reset\n            });\n            \n            function convertSrtToVtt(srtContent) {\n                let vttContent = 'WEBVTT\\n\\n';\n                vttContent += srtContent\n                    .replace(/(\\d{2}:\\d{2}:\\d{2}),(\\d{3})/g, '$1.$2')\n                    .replace(/\\r\\n/g, '\\n')\n                    .replace(/\\n{3,}/g, '\\n\\n');\n                return vttContent;\n            }\n            \n            // ä¿®æ”¹1: å¢å¼ºLRCè§£æå‡½æ•°\n            function parseLrcToLyrics(lrcContent) {\n                const lines = lrcContent.split('\\n');\n                const lyrics = [];\n                \n                // é¦–å…ˆæ”¶é›†æ‰€æœ‰æ—¶é—´æ ‡ç­¾å’Œæ­Œè¯\n                const rawLyrics = [];\n                \n                for (let i = 0; i < lines.length; i++) {\n                    const line = lines[i].trim();\n                    if (!line) continue;\n                    \n                    // åŒ¹é…LRCæ—¶é—´æ ‡ç­¾: [mm:ss.xx] æˆ– [mm:ss]\n                    const timeMatch = line.match(/\\[(\\d{2}):(\\d{2})(?:\\.(\\d{2,3}))?\\](.*)/);\n                    if (timeMatch) {\n                        const minutes = timeMatch[1];\n                        const seconds = timeMatch[2];\n                        const milliseconds = timeMatch[3] ? timeMatch[3].padEnd(3, '0') : '000';\n                        const text = timeMatch[4].trim();\n                        \n                        if (text) {\n                            const startTime = parseFloat(minutes) * 60 + parseFloat(seconds) + parseFloat(milliseconds) / 1000;\n                            rawLyrics.push({ startTime, text });\n                        }\n                    }\n                }\n                \n                // æŒ‰æ—¶é—´æ’åº\n                rawLyrics.sort((a, b) => a.startTime - b.startTime);\n                \n                // ä¸ºæ¯å¥æ­Œè¯è®¡ç®—ç»“æŸæ—¶é—´ï¼ˆä¸‹ä¸€å¥çš„å¼€å§‹æ—¶é—´ï¼‰\n                for (let i = 0; i < rawLyrics.length; i++) {\n                    const current = rawLyrics[i];\n                    const next = rawLyrics[i + 1];\n                    \n                    lyrics.push({\n                        startTime: current.startTime,\n                        endTime: next ? next.startTime : current.startTime + 5, // æœ€åä¸€å¥é»˜è®¤æ˜¾ç¤º5ç§’\n                        text: current.text\n                    });\n                }\n                \n                return lyrics;\n            }\n            \n            // ä¿®æ”¹1: å¢å¼ºparseLyricså‡½æ•°ä»¥æ”¯æŒLRCæ ¼å¼\n            function parseLyrics(lyricText) { \n                currentLyrics = []; \n                \n                // æ£€æŸ¥æ˜¯å¦æ˜¯VTTæ ¼å¼\n                if (lyricText.includes('WEBVTT') || lyricText.includes('-->')) {\n                    const lines = lyricText.split('\\n');\n                    const regex = /(\\d{2}:\\d{2}:\\d{2}\\.\\d{3}|\\d{2}:\\d{2}\\.\\d{3})\\s*-->\\s*(\\d{2}:\\d{2}:\\d{2}\\.\\d{3}|\\d{2}:\\d{2}\\.\\d{3})/;\n                    \n                    for (let i = 0; i < lines.length; i++) {\n                        const match = lines[i].trim().match(regex);\n                        if (match && i + 1 < lines.length) {\n                            const textLine = lines[i + 1].trim();\n                            if (textLine && !textLine.includes('-->')) {\n                                currentLyrics.push({ \n                                    startTime: parseTime(match[1]), \n                                    endTime: parseTime(match[2]), \n                                    text: textLine \n                                });\n                                i++;\n                            }\n                        }\n                    }\n                } \n                // æ£€æŸ¥æ˜¯å¦æ˜¯LRCæ ¼å¼ï¼ˆåŒ…å«æ—¶é—´æ ‡ç­¾ [mm:ss.xx]ï¼‰\n                else if (lyricText.includes('[') && lyricText.match(/\\[\\d{2}:\\d{2}(?:\\.\\d{2,3})?\\]/)) {\n                    currentLyrics = parseLrcToLyrics(lyricText);\n                }\n                else {\n                    // å°è¯•å…¶ä»–æ ¼å¼\n                    const lines = lyricText.split('\\n');\n                    for (const line of lines) {\n                        const trimmed = line.trim();\n                        if (trimmed) {\n                            const srtMatch = trimmed.match(/(\\d{2}:\\d{2}:\\d{2},\\d{3})\\s*-->\\s*(\\d{2}:\\d{2}:\\d{2},\\d{3})/);\n                            if (srtMatch) {\n                                continue;\n                            }\n                            \n                            if (!trimmed.match(/\\d+\\s*$/) && !trimmed.match(/^(\\d{2}:\\d{2}:\\d{2}|WEBVTT)/)) {\n                                currentLyrics.push({ \n                                    startTime: currentLyrics.length * 3,\n                                    endTime: (currentLyrics.length + 1) * 3,\n                                    text: trimmed \n                                });\n                            }\n                        }\n                    }\n                }\n                \n                // å¦‚æœæ²¡æœ‰è§£æåˆ°æ­Œè¯ï¼Œæ·»åŠ ä¸€ä¸ªé»˜è®¤é¡¹\n                if (currentLyrics.length === 0 && lyricText.trim()) {\n                    currentLyrics.push({ \n                        startTime: 0, \n                        endTime: 60, \n                        text: lyricText.split('\\n')[0].trim() || '...' \n                    });\n                }\n                \n                // ä¿®æ”¹1: ç¡®ä¿æ­Œè¯æŒ‰æ—¶é—´æ’åº\n                currentLyrics.sort((a, b) => a.startTime - b.startTime);\n                \n                console.log('è§£æåçš„æ­Œè¯:', currentLyrics);\n            }\n            \n            function parseTime(t) { \n                const parts = t.split(':');\n                if (parts.length === 3) {\n                    return (parseInt(parts[0], 10) * 3600) + (parseInt(parts[1], 10) * 60) + parseFloat(parts[2]);\n                } else if (parts.length === 2) {\n                    return (parseInt(parts[0], 10) * 60) + parseFloat(parts[1]);\n                }\n                return 0;\n            }\n            \n            function renderFullLyrics() {\n                const list = document.getElementById('full-lyrics-list');\n                list.innerHTML = '';\n                currentLyrics.forEach((line, index) => {\n                    const p = document.createElement('p');\n                    p.className = 'full-lyric-line';\n                    p.textContent = line.text;\n                    p.dataset.startTime = line.startTime;\n                    p.dataset.index = index;\n                    p.onclick = () => { document.getElementById('audio-player').currentTime = line.startTime; };\n                    list.appendChild(p);\n                });\n            }\n\n            // ä¿®æ”¹1: å¢å¼ºæ­Œè¯æ˜¾ç¤ºé€»è¾‘ï¼Œæ”¯æŒLRCæ ¼å¼çš„\"ä¿æŒæ˜¾ç¤ºä¸Šä¸€å¥\"åŠŸèƒ½\n            function updatePlayerState() {\n                const audio = document.getElementById('audio-player');\n                const currentTime = audio.currentTime;\n                \n                // ä¿®æ”¹1: æŸ¥æ‰¾å½“å‰åº”è¯¥æ˜¾ç¤ºçš„æ­Œè¯\n                let activeIndex = -1;\n                \n                // éå†æ­Œè¯ï¼Œæ‰¾åˆ°æœ€åä¸€ä¸ªå¼€å§‹æ—¶é—´å°äºç­‰äºå½“å‰æ—¶é—´çš„æ­Œè¯\n                for (let i = 0; i < currentLyrics.length; i++) {\n                    if (currentTime >= currentLyrics[i].startTime) {\n                        // å¦‚æœè¿™æ˜¯æœ€åä¸€å¥ï¼Œæˆ–è€…å½“å‰æ—¶é—´å°äºä¸‹ä¸€å¥çš„å¼€å§‹æ—¶é—´\n                        if (i === currentLyrics.length - 1 || currentTime < currentLyrics[i + 1].startTime) {\n                            activeIndex = i;\n                        }\n                    }\n                }\n                \n                // æ›´æ–°æ­Œè¯æ°”æ³¡\n                const bubbleEl = document.getElementById('lyric-display');\n                if (activeIndex !== -1) {\n                    bubbleEl.textContent = currentLyrics[activeIndex].text;\n                } else {\n                    bubbleEl.textContent = '...';\n                }\n\n                // æ›´æ–°å…¨å±æ­Œè¯åˆ—è¡¨\n                const listLines = document.querySelectorAll('.full-lyric-line');\n                listLines.forEach(l => l.classList.remove('active'));\n                if (activeIndex !== -1) {\n                    const activeLine = listLines[activeIndex];\n                    if (activeLine) {\n                        activeLine.classList.add('active');\n                        activeLine.scrollIntoView({ behavior: 'smooth', block: 'center' });\n                    }\n                }\n\n                const now = Date.now();\n                if (now - lastSaveTime > 3000) {\n                    const currentSongId = parseInt(document.getElementById('player-view').dataset.currentSongId);\n                    if (currentSongId && !audio.paused) { db.settings.put({ key: 'lastPlaybackState', value: { songId: currentSongId, currentTime: audio.currentTime } }); }\n                    lastSaveTime = now;\n                }\n            }\n\n            document.getElementById('audio-file-input').addEventListener('change', function(e) {\n                if (this.files.length > 0) {\n                    const file = this.files[0];\n                    const fileName = file.name;\n                    const title = fileName.replace(/\\.[^/.]+$/, \"\");\n                    const titleInput = document.getElementById('song-title-input');\n                    if (!titleInput.value || titleInput.value === '') {\n                        titleInput.value = title;\n                    }\n                }\n            });\n\n            document.getElementById('save-preset-btn').addEventListener('click', async () => {\n                const title = document.getElementById('song-title-input').value;\n                const lyricsText = document.getElementById('lyric-input').value;\n                const folderId = document.getElementById('song-folder-select').value;\n                const audioSourceType = document.querySelector('input[name=\"audioSource\"]:checked').value;\n                let audioSource;\n                if (audioSourceType === 'file') {\n                    audioSource = document.getElementById('audio-file-input').files[0];\n                    if (!audioSource) { showUploadStatus('è¯·é€‰æ‹©ä¸€ä¸ªéŸ³é¢‘æ–‡ä»¶ï¼'); return; }\n                } else {\n                    audioSource = document.getElementById('audio-url-input').value.trim();\n                    if (!audioSource) { showUploadStatus('è¯·è¾“å…¥éŸ³é¢‘URLï¼'); return; }\n                }\n                if (!title) { showUploadStatus('è¯·å¡«å†™æ­Œæ›²æ ‡é¢˜ï¼'); return; }\n                \n                showUploadStatus('æ­£åœ¨ä¿å­˜æ­Œæ›²...');\n                try {\n                    await db.songs.add({ title, lyrics: lyricsText, audioType: audioSourceType, audioSource, imageFile: croppedImageBlob, folderId: folderId });\n                    showUploadStatus('ä¿å­˜æˆåŠŸï¼');\n                    croppedImageBlob = null; document.getElementById('add-image-preview').style.display = 'none';\n                    document.getElementById('song-title-input').value = ''; document.getElementById('lyric-input').value = '';\n                    document.getElementById('audio-file-input').value = ''; document.getElementById('audio-url-input').value = '';\n                    document.getElementById('image-file-input').value = '';\n                    navigateTo('playlist-view'); \n                    currentFolderId = folderId || 'uncategorized';\n                    renderPlaylist();\n                } catch (error) {\n                    console.error('ä¿å­˜å¤±è´¥:', error);\n                    showUploadStatus('ä¿å­˜å¤±è´¥: ' + error.message);\n                }\n            });\n\n            async function openEditView(id) {\n                const song = await db.songs.get(id); if (!song) return;\n                const form = document.getElementById('edit-song-form'); form.dataset.songId = id;\n                document.getElementById('edit-view-title').textContent = `ç¼–è¾‘: ${song.title}`;\n                document.getElementById('edit-song-title-input').value = song.title; document.getElementById('edit-lyric-input').value = song.lyrics;\n                document.getElementById('edit-image-preview').src = song.imageFile ? URL.createObjectURL(song.imageFile) : '';\n                \n                await loadFoldersIntoSelect('edit-song-folder-select', song.folderId, false);\n                \n                navigateTo('edit-song-view');\n            }\n            document.getElementById('edit-song-form').addEventListener('submit', async e => {\n                e.preventDefault(); const form = e.target, id = parseInt(form.dataset.songId);\n                const updates = { \n                    title: document.getElementById('edit-song-title-input').value, \n                    lyrics: document.getElementById('edit-lyric-input').value,\n                    folderId: document.getElementById('edit-song-folder-select').value\n                };\n                const audioFile = document.getElementById('edit-audio-file-input').files[0];\n                if (audioFile) { updates.audioType = 'file'; updates.audioSource = audioFile; }\n                if (croppedImageBlob) updates.imageFile = croppedImageBlob;\n                showUploadStatus('æ­£åœ¨æ›´æ–°æ­Œæ›²...');\n                try {\n                    await db.songs.update(id, updates);\n                    showUploadStatus('æ›´æ–°æˆåŠŸï¼');\n                    croppedImageBlob = null; form.reset(); \n                    navigateTo('playlist-view'); \n                    currentFolderId = updates.folderId || 'uncategorized';\n                    renderPlaylist();\n                } catch (error) {\n                    console.error('æ›´æ–°å¤±è´¥:', error);\n                    showUploadStatus('æ›´æ–°å¤±è´¥: ' + error.message);\n                }\n            });\n\n            async function startPlayback(id) {\n                revokeURLs('player');\n                const playerView = document.getElementById('player-view');\n                playerView.dataset.currentSongId = id;\n                const [song, globalPlayerBg, coverWidth, coverHeight, lastState, playerLayout] = await Promise.all([\n                    db.songs.get(id), \n                    db.settings.get('playerBg'), \n                    db.settings.get('coverWidth'), \n                    db.settings.get('coverHeight'), \n                    db.settings.get('lastPlaybackState'),\n                    db.settings.get('playerLayout')\n                ]);\n                if (!song) return;\n                let startTime = 0;\n                if (lastState && lastState.value.songId === id) startTime = lastState.value.currentTime;\n                if (song.backgroundFile) { const url = URL.createObjectURL(song.backgroundFile); tempObjectURLs.player.push(url); playerView.style.backgroundImage = `url(${url})`; } \n                else if (globalPlayerBg && globalPlayerBg.value) { const url = URL.createObjectURL(globalPlayerBg.value); tempObjectURLs.player.push(url); playerView.style.backgroundImage = `url(${url})`; } \n                else { playerView.style.backgroundImage = ''; }\n                const imageUrl = song.imageFile ? URL.createObjectURL(song.imageFile) : defaultCover;\n                tempObjectURLs.player.push(imageUrl);\n                const audioPlayer = document.getElementById('audio-player');\n                const downloadLink = document.getElementById('download-song-link');\n\n                const songTitleBox = document.getElementById('song-title-box');\n                let displayTitle = song.title;\n                if (song.audioType === 'file' && song.audioSource && song.audioSource.name) {\n                    displayTitle = song.audioSource.name;\n                }\n                songTitleBox.textContent = displayTitle;\n\n                if (song.audioType === 'url') { \n                    audioPlayer.src = song.audioSource;\n                    downloadLink.href = song.audioSource;\n                    downloadLink.target = '_blank';\n                    downloadLink.download = '';\n                } else { \n                    const audioUrl = URL.createObjectURL(song.audioSource || song.audioFile); \n                    tempObjectURLs.player.push(audioUrl); \n                    audioPlayer.src = audioUrl;\n                    downloadLink.href = audioUrl;\n                    downloadLink.target = '_self';\n                    const audioFile = song.audioSource || song.audioFile;\n                    downloadLink.download = audioFile.name || `${song.title}.mp3`;\n                }\n                const albumArt = document.getElementById('album-art');\n                const lyricBubble = document.querySelector('.lyric-bubble');\n                const w = coverWidth?.value, h = coverHeight?.value;\n                albumArt.style.width = w ? `${w}px` : '70vw';\n                albumArt.style.height = h ? `${h}px` : '70vw';\n                albumArt.style.maxWidth = w ? `${w}px` : '300px';\n                albumArt.style.maxHeight = h ? `${h}px` : '300px';\n                albumArt.src = imageUrl;\n\n                if (playerLayout && playerLayout.value) {\n                    const l = playerLayout.value;\n                    if(l.art) {\n                        albumArt.style.transform = `translate3d(${l.art.x}px, ${l.art.y}px, 0)`;\n                        albumArt.dataset.dragX = l.art.x;\n                        albumArt.dataset.dragY = l.art.y;\n                    } else {\n                        albumArt.style.transform = ''; delete albumArt.dataset.dragX; delete albumArt.dataset.dragY;\n                    }\n                    if(l.lyric) {\n                        lyricBubble.style.transform = `translateX(-50%) translate3d(${l.lyric.x}px, ${l.lyric.y}px, 0)`;\n                        lyricBubble.dataset.dragX = l.lyric.x;\n                        lyricBubble.dataset.dragY = l.lyric.y;\n                    } else {\n                         lyricBubble.style.transform = 'translateX(-50%)'; delete lyricBubble.dataset.dragX; delete lyricBubble.dataset.dragY;\n                    }\n                    if(l.title) {\n                        songTitleBox.style.transform = `translateX(-50%) translate3d(${l.title.x}px, ${l.title.y}px, 0)`;\n                        songTitleBox.dataset.dragX = l.title.x;\n                        songTitleBox.dataset.dragY = l.title.y;\n                    } else {\n                        songTitleBox.style.transform = 'translateX(-50%)'; delete songTitleBox.dataset.dragX; delete songTitleBox.dataset.dragY;\n                    }\n                } else {\n                    albumArt.style.transform = '';\n                    delete albumArt.dataset.dragX;\n                    delete albumArt.dataset.dragY;\n                    lyricBubble.style.transform = 'translateX(-50%)';\n                    delete lyricBubble.dataset.dragX;\n                    delete lyricBubble.dataset.dragY;\n                    songTitleBox.style.transform = 'translateX(-50%)';\n                    delete songTitleBox.dataset.dragX;\n                    delete songTitleBox.dataset.dragY;\n                }\n\n                audioPlayer.onloadedmetadata = () => { if (startTime > 0 && startTime < audioPlayer.duration) audioPlayer.currentTime = startTime; audioPlayer.play(); };\n                parseLyrics(song.lyrics); \n                renderFullLyrics();\n                navigateTo('player-view');\n            }\n            \n            const audioPlayer = document.getElementById('audio-player');\n            audioPlayer.addEventListener('timeupdate', () => {\n                updatePlayerState();\n                const progressBar = document.getElementById('progress-bar');\n                if (!isNaN(audioPlayer.duration)) {\n                    progressBar.value = audioPlayer.currentTime;\n                    document.getElementById('current-time').textContent = formatTime(audioPlayer.currentTime);\n                }\n            });\n            audioPlayer.addEventListener('loadedmetadata', () => {\n                const progressBar = document.getElementById('progress-bar');\n                progressBar.max = audioPlayer.duration;\n                document.getElementById('duration-time').textContent = formatTime(audioPlayer.duration);\n            });\n            audioPlayer.addEventListener('play', () => { document.getElementById('play-pause-btn').innerHTML = 'âšâš'; });\n            audioPlayer.addEventListener('pause', () => { document.getElementById('play-pause-btn').innerHTML = 'â–¶'; });\n            \n            async function getSiblingSongId(currentId, direction) {\n                const currentSong = await db.songs.get(currentId);\n                if(!currentSong) return null;\n                \n                let songsInContext = [];\n                if(currentSong.folderId) {\n                    songsInContext = await db.songs.where('folderId').equals(currentSong.folderId).toArray();\n                } else {\n                    const allSongs = await db.songs.toArray();\n                    songsInContext = allSongs.filter(s => !s.folderId);\n                }\n                \n                songsInContext.sort((a, b) => a.id - b.id);\n                \n                const currentIndex = songsInContext.findIndex(s => s.id === currentId);\n                if(currentIndex === -1) return null;\n                \n                let nextIndex;\n                if(direction === 'next') {\n                    nextIndex = currentIndex + 1;\n                    if(nextIndex >= songsInContext.length) nextIndex = 0;\n                } else {\n                    nextIndex = currentIndex - 1;\n                    if(nextIndex < 0) nextIndex = songsInContext.length - 1;\n                }\n                \n                return songsInContext[nextIndex].id;\n            }\n\n            audioPlayer.addEventListener('ended', async () => { \n                db.settings.delete('lastPlaybackState');\n                if (stopAtSongEnd) {\n                    audioPlayer.pause();\n                    stopAtSongEnd = false;\n                    updateSleepTimerUI();\n                    return;\n                }\n                if(isContinuousPlay) {\n                    const currentId = parseInt(document.getElementById('player-view').dataset.currentSongId);\n                    const nextId = await getSiblingSongId(currentId, 'next');\n                    if(nextId) startPlayback(nextId);\n                }\n            });\n\n            function formatTime(seconds) {\n                const min = Math.floor(seconds / 60);\n                const sec = Math.floor(seconds % 60);\n                return `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;\n            }\n\n            function setupCustomControls() {\n                const playPauseBtn = document.getElementById('play-pause-btn');\n                const prevBtn = document.getElementById('prev-btn');\n                const nextBtn = document.getElementById('next-btn');\n                const progressBar = document.getElementById('progress-bar');\n                const playerSettingsBtn = document.getElementById('player-settings-btn');\n                const playerSettingsMenu = document.getElementById('player-settings-menu');\n                const playbackSpeedSelect = document.getElementById('playback-speed');\n                const continuousPlayBtn = document.getElementById('toggle-continuous-play');\n                \n                const fullLyricsBtn = document.getElementById('full-lyrics-btn');\n                const fullLyricsModal = document.getElementById('full-lyrics-modal');\n                const closeLyricsBtn = document.querySelector('.close-lyrics-btn');\n                \n                const resetBgBtn = document.getElementById('reset-bg-btn');\n\n                playPauseBtn.addEventListener('click', () => {\n                    if (audioPlayer.paused) { audioPlayer.play(); } else { audioPlayer.pause(); }\n                });\n                \n                prevBtn.addEventListener('click', async () => {\n                    const currentId = parseInt(document.getElementById('player-view').dataset.currentSongId);\n                    const prevId = await getSiblingSongId(currentId, 'prev');\n                    if(prevId) startPlayback(prevId);\n                });\n                \n                nextBtn.addEventListener('click', async () => {\n                    const currentId = parseInt(document.getElementById('player-view').dataset.currentSongId);\n                    const nextId = await getSiblingSongId(currentId, 'next');\n                    if(nextId) startPlayback(nextId);\n                });\n\n                progressBar.addEventListener('input', () => { audioPlayer.currentTime = progressBar.value; });\n\n                playerSettingsBtn.addEventListener('click', (e) => {\n                    e.stopPropagation();\n                    playerSettingsMenu.classList.toggle('visible');\n                });\n                document.addEventListener('click', (e) => {\n                    if (!playerSettingsMenu.contains(e.target) && e.target !== playerSettingsBtn) {\n                        playerSettingsMenu.classList.remove('visible');\n                    }\n                });\n                playbackSpeedSelect.addEventListener('change', (e) => {\n                    audioPlayer.playbackRate = parseFloat(e.target.value);\n                });\n                \n                continuousPlayBtn.addEventListener('click', async (e) => {\n                    e.preventDefault();\n                    isContinuousPlay = !isContinuousPlay;\n                    await db.settings.put({key: 'continuousPlay', value: isContinuousPlay});\n                    updateContinuousPlayUI();\n                });\n\n                fullLyricsBtn.addEventListener('click', () => {\n                    fullLyricsModal.classList.add('active');\n                });\n                closeLyricsBtn.addEventListener('click', () => {\n                    fullLyricsModal.classList.remove('active');\n                });\n                \n                resetBgBtn.addEventListener('click', async () => {\n                    const playerView = document.getElementById('player-view');\n                    const currentSongId = parseInt(playerView.dataset.currentSongId);\n                    \n                    if (currentSongId) {\n                        await db.songs.update(currentSongId, { backgroundFile: null });\n                        playerView.style.backgroundImage = '';\n                        showUploadStatus('èƒŒæ™¯å·²é‡ç½®');\n                    }\n                });\n                \n                const resetBtn = document.getElementById('reset-positions-btn');\n                if(resetBtn) {\n                    resetBtn.addEventListener('click', async () => {\n                        if(confirm('ç¡®å®šè¦é‡ç½®æ’­æ”¾ç•Œé¢çš„æ‰€æœ‰å…ƒç´ ï¼ˆå°é¢ã€æ­Œè¯ã€æ­Œåï¼‰ä½ç½®å—ï¼Ÿ')) {\n                            await db.settings.delete('playerLayout');\n                            showUploadStatus('ä½ç½®å·²é‡ç½®ï¼Œä¸‹æ¬¡æ’­æ”¾æ—¶ç”Ÿæ•ˆã€‚');\n                        }\n                    });\n                }\n            }\n            \n            function updateContinuousPlayUI() {\n                const btn = document.getElementById('toggle-continuous-play');\n                btn.textContent = `è¿ç»­æ’­æ”¾: ${isContinuousPlay ? 'å¼€å¯ âœ…' : 'å…³é—­'}`;\n            }\n\n            function setupDraggableElement(element, container) {\n                let isDragging = false, startEventX, startEventY, startDragX, startDragY;\n\n                const dragStart = (e) => {\n                    if (e.target.closest(`#${element.id}`)) {\n                        isDragging = true;\n                        element.classList.add('dragging');\n                        const event = e.type === 'touchstart' ? e.touches[0] : e;\n                        startEventX = event.clientX;\n                        startEventY = event.clientY;\n                        \n                        startDragX = parseFloat(element.dataset.dragX || 0);\n                        startDragY = parseFloat(element.dataset.dragY || 0);\n\n                        container.addEventListener('mousemove', drag);\n                        container.addEventListener('touchmove', drag, { passive: false });\n                        window.addEventListener('mouseup', dragEnd);\n                        window.addEventListener('touchend', dragEnd);\n                    }\n                };\n\n                const drag = (e) => {\n                    if (!isDragging) return;\n                    e.preventDefault();\n                    const event = e.type === 'touchmove' ? e.touches[0] : e;\n                    const deltaX = event.clientX - startEventX;\n                    const deltaY = event.clientY - startEventY;\n                    let newX, newY;\n\n                    newX = startDragX + deltaX;\n                    newY = startDragY + deltaY;\n                    \n                    let transformString = `translate3d(${newX}px, ${newY}px, 0)`;\n                    \n                    if (element.id === 'lyric-bubble' || element.id === 'song-title-box') {\n                         transformString = `translateX(-50%) ${transformString}`;\n                    }\n                    element.style.transform = transformString;\n                };\n\n                const dragEnd = async (e) => {\n                    if (isDragging) {\n                        isDragging = false;\n                        element.classList.remove('dragging');\n                        \n                        const event = e.type === 'touchend' ? (e.changedTouches[0] || e) : e;\n                        const deltaX = event.clientX - startEventX;\n                        const deltaY = event.clientY - startEventY;\n\n                        const finalX = startDragX + deltaX;\n                        const finalY = startDragY + deltaY;\n                        \n                        element.dataset.dragX = finalX;\n                        element.dataset.dragY = finalY;\n\n                        container.removeEventListener('mousemove', drag);\n                        container.removeEventListener('touchmove', drag);\n                        window.removeEventListener('mouseup', dragEnd);\n                        window.removeEventListener('touchend', dragEnd);\n\n                        const albumArt = document.getElementById('album-art');\n                        const lyricBubble = document.getElementById('lyric-bubble');\n                        const songTitleBox = document.getElementById('song-title-box');\n\n                        const layout = {\n                            art: { x: parseFloat(albumArt.dataset.dragX || 0), y: parseFloat(albumArt.dataset.dragY || 0) },\n                            lyric: { x: parseFloat(lyricBubble.dataset.dragX || 0), y: parseFloat(lyricBubble.dataset.dragY || 0) },\n                            title: { x: parseFloat(songTitleBox.dataset.dragX || 0), y: parseFloat(songTitleBox.dataset.dragY || 0) }\n                        };\n                        await db.settings.put({ key: 'playerLayout', value: layout });\n                    }\n                };\n\n                container.addEventListener('mousedown', dragStart);\n                container.addEventListener('touchstart', dragStart, { passive: false });\n            }\n            \n            function updateSleepTimerUI() {\n                const settingsBtn = document.getElementById('player-settings-btn');\n                if (sleepTimerId || stopAtSongEnd) {\n                    settingsBtn.textContent = 'â°';\n                } else {\n                    settingsBtn.textContent = 'â‹®';\n                }\n            }\n\n            function setupSleepTimer() {\n                const menu = document.getElementById('player-settings-menu');\n                menu.addEventListener('click', (e) => {\n                    const target = e.target.closest('[data-time]');\n                    if (!target) return;\n                    \n                    e.preventDefault();\n                    clearTimeout(sleepTimerId);\n                    sleepTimerId = null;\n                    stopAtSongEnd = false;\n\n                    const time = parseInt(target.dataset.time, 10);\n                    if (time > 0) {\n                        sleepTimerId = setTimeout(() => {\n                            audioPlayer.pause();\n                            sleepTimerId = null;\n                            updateSleepTimerUI();\n                        }, time * 60 * 1000);\n                    } else if (time === -1) {\n                        stopAtSongEnd = true;\n                    }\n                    \n                    updateSleepTimerUI();\n                    menu.classList.remove('visible');\n                });\n            }\n\n            function setupColorPicker() {\n                const picker = document.getElementById('color-picker'), toggleBtn = document.getElementById('toggle-color-picker-btn');\n                const colors = ['#FFFFFF', '#1DB954', '#FFC107', 'rgba(255,165,0,1)', 'rgba(0,191,255,1)', '#E91E63', '#9C27B0', 'rgba(135,206,250,1)'];\n                picker.innerHTML = '';\n                colors.forEach(color => { const swatch = document.createElement('div'); swatch.className = 'color-swatch'; swatch.style.backgroundColor = color; swatch.addEventListener('click', async () => { document.documentElement.style.setProperty('--lyric-color', color); await db.settings.put({ key: 'lyricColor', value: color }); picker.classList.remove('visible'); }); picker.appendChild(swatch); });\n                toggleBtn.addEventListener('click', e => { e.stopPropagation(); picker.classList.toggle('visible'); });\n                document.addEventListener('click', e => { if (!picker.contains(e.target) && e.target !== toggleBtn) picker.classList.remove('visible'); });\n            }\n            \n            document.getElementById('export-btn').addEventListener('click', async () => {\n                const exportBtn = document.getElementById('export-btn');\n                try {\n                    exportBtn.textContent = 'æ­£åœ¨æ‰“åŒ…...'; exportBtn.disabled = true;\n                    showUploadStatus('æ­£åœ¨å¯¼å‡ºæ•°æ®...');\n                    const zip = new JSZip();\n                    const songs = await db.songs.toArray();\n                    const settings = await db.settings.toArray();\n                    const folders = await db.folders.toArray();\n                    \n                    const filesFolder = zip.folder('files');\n                    const metadata = { songs: [], settings: [], folders: folders };\n\n                    for (const song of songs) {\n                        const songMeta = { ...song };\n                        if (song.audioType === 'file' || (!song.audioType && song.audioFile)) {\n                            const source = song.audioSource || song.audioFile;\n                            if(source) {\n                                const fileName = `${song.id}_audio.${source.name.split('.').pop()}`;\n                                filesFolder.file(fileName, source);\n                                songMeta.audioSource = fileName;\n                            }\n                        }\n                        if (song.imageFile) { const fileExt = song.imageFile.type === 'image/gif' ? 'gif' : 'jpg'; const fileName = `${song.id}_cover.${fileExt}`; filesFolder.file(fileName, song.imageFile); songMeta.imageFile = fileName; }\n                        if (song.backgroundFile) { const fileName = `${song.id}_bg.jpg`; filesFolder.file(fileName, song.backgroundFile); songMeta.backgroundFile = fileName; }\n                        delete songMeta.audioFile;\n                        metadata.songs.push(songMeta);\n                    }\n\n                    for (const setting of settings) {\n                        const settingMeta = { ...setting };\n                        if (setting.value instanceof Blob) {\n                            const fileName = `${setting.key}.jpg`;\n                            filesFolder.file(fileName, setting.value);\n                            settingMeta.value = fileName;\n                        }\n                        metadata.settings.push(settingMeta);\n                    }\n\n                    zip.file('metadata.json', JSON.stringify(metadata));\n                    const content = await zip.generateAsync({type:\"blob\"});\n                    const url = URL.createObjectURL(content);\n                    const a = document.createElement('a');\n                    a.href = url;\n                    a.download = `music-os-backup-${new Date().toISOString().slice(0, 10)}.zip`;\n                    a.click();\n                    URL.revokeObjectURL(url);\n                    showUploadStatus('å¯¼å‡ºæˆåŠŸï¼');\n                } catch (e) {\n                    showUploadStatus('å¯¼å‡ºå¤±è´¥: ' + e);\n                } finally {\n                    exportBtn.textContent = 'å¯¼å‡ºå…¨éƒ¨æ•°æ®'; exportBtn.disabled = false;\n                }\n            });\n\n            const importFileInput = document.getElementById('import-file-input');\n            const honorImportInput = document.getElementById('honor-import-file-input');\n            \n            // è£è€€æ‰‹æœºä½¿ç”¨ä¸“ç”¨å¯¼å…¥æŒ‰é’®\n            if (isHonorOrHuawei) {\n                // honorImportInputçš„changeäº‹ä»¶å·²ç»åœ¨initHonorFileUploadä¸­å¤„ç†\n            } else {\n                document.getElementById('import-btn').addEventListener('click', () => importFileInput.click());\n            }\n            \n            importFileInput.addEventListener('change', handleImportFile);\n            honorImportInput.addEventListener('change', function() {\n                if (this.files && this.files.length > 0) {\n                    const file = this.files[0];\n                    const dataTransfer = new DataTransfer();\n                    dataTransfer.items.add(file);\n                    importFileInput.files = dataTransfer.files;\n                    \n                    const event = new Event('change', { bubbles: true });\n                    importFileInput.dispatchEvent(event);\n                }\n            });\n            \n            async function handleImportFile(e) {\n                const file = e.target.files[0];\n                const importBtn = document.getElementById('import-btn');\n                if (!file || !confirm('ç¡®å®šå¯¼å…¥å—ï¼Ÿè¿™å°†è¦†ç›–æ‰€æœ‰ç°æœ‰æ•°æ®ï¼')) return;\n                \n                try {\n                    if (importBtn) {\n                        importBtn.textContent = \"æ­£åœ¨å¯¼å…¥...\"; \n                        importBtn.disabled = true;\n                    }\n                    showUploadStatus('æ­£åœ¨å¯¼å…¥æ•°æ®...');\n                    const zip = await JSZip.loadAsync(file);\n                    const metadataFile = zip.file('metadata.json');\n                    if (!metadataFile) throw new Error('å¤‡ä»½æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡® (ç¼ºå°‘ metadata.json)');\n                    const metadata = JSON.parse(await metadataFile.async('string'));\n                    \n                    const filesFolder = zip.folder('files');\n                    \n                    for (const songMeta of metadata.songs) {\n                        if (songMeta.audioType === 'file' && songMeta.audioSource) songMeta.audioSource = await filesFolder.file(songMeta.audioSource).async('blob');\n                        if (songMeta.imageFile) songMeta.imageFile = await filesFolder.file(songMeta.imageFile).async('blob');\n                        if (songMeta.backgroundFile) songMeta.backgroundFile = await filesFolder.file(songMeta.backgroundFile).async('blob');\n                    }\n                    for (const settingMeta of metadata.settings) {\n                        if (typeof settingMeta.value === 'string' && filesFolder.file(settingMeta.value)) {\n                            settingMeta.value = await filesFolder.file(settingMeta.value).async('blob');\n                        }\n                    }\n\n                    await db.transaction('rw', db.songs, db.settings, db.folders, async () => {\n                        await db.songs.clear();\n                        await db.settings.clear();\n                        await db.folders.clear();\n                        await db.songs.bulkPut(metadata.songs);\n                        await db.settings.bulkPut(metadata.settings);\n                        if(metadata.folders) await db.folders.bulkPut(metadata.folders);\n                    });\n\n                    showUploadStatus('å¯¼å…¥æˆåŠŸï¼åº”ç”¨å°†é‡æ–°åŠ è½½ã€‚');\n                    setTimeout(() => {\n                        location.reload();\n                    }, 2000);\n                } catch (err) {\n                    console.error('å¯¼å…¥å¤±è´¥:', err);\n                    showUploadStatus('å¯¼å…¥å¤±è´¥ï¼' + err.message);\n                } finally {\n                    if (importBtn) {\n                        importBtn.textContent = \"å¯¼å…¥å¤‡ä»½æ–‡ä»¶ (è¦†ç›–)\"; \n                        importBtn.disabled = false;\n                    }\n                }\n            }\n            \n            function handleImageSelection(file, previewElementId) {\n                if (file.type === 'image/gif') {\n                    croppedImageBlob = file;\n                    const preview = document.getElementById(previewElementId);\n                    preview.src = URL.createObjectURL(file);\n                    preview.style.display = 'block';\n                    if (cropper) cropper.destroy();\n                } else {\n                    initCropper(file, previewElementId);\n                }\n            }\n\n            async function initCropper(file, previewElementId) {\n                const modal = document.getElementById('crop-modal-overlay'), image = document.getElementById('cropper-image');\n                const [w, h] = await Promise.all([db.settings.get('coverWidth'), db.settings.get('coverHeight')]);\n                const ratio = (w?.value && h?.value) ? w.value / h.value : 1;\n                image.src = URL.createObjectURL(file); modal.style.display = 'flex';\n                if (cropper) cropper.destroy();\n                cropper = new Cropper(image, { aspectRatio: ratio, viewMode: 1 });\n                document.getElementById('confirm-crop-btn').onclick = () => { cropper.getCroppedCanvas().toBlob(blob => { croppedImageBlob = blob; const preview = document.getElementById(previewElementId); preview.src = URL.createObjectURL(blob); preview.style.display = 'block'; modal.style.display = 'none'; }); };\n                document.getElementById('cancel-crop-btn').onclick = () => { modal.style.display = 'none'; cropper.destroy(); };\n            }\n\n            document.getElementById('image-file-input').addEventListener('change', e => { if (e.target.files[0]) handleImageSelection(e.target.files[0], 'add-image-preview'); });\n            document.getElementById('edit-image-file-input').addEventListener('change', e => { if (e.target.files[0]) handleImageSelection(e.target.files[0], 'edit-image-preview'); });\n\n            const setSongBgBtn = document.getElementById('set-song-bg-btn');\n            const songBgInput = document.getElementById('song-bg-input');\n            setSongBgBtn.addEventListener('click', () => {\n                // å¦‚æœæ˜¯è£è€€æ‰‹æœºï¼Œä½¿ç”¨ç‰¹æ®Šæ–¹æ³•\n                if (isHonorOrHuawei) {\n                    const tempInput = document.createElement('input');\n                    tempInput.type = 'file';\n                    tempInput.accept = 'image/*';\n                    tempInput.style.display = 'none';\n                    \n                    tempInput.addEventListener('change', function() {\n                        if (this.files && this.files.length > 0) {\n                            const file = this.files[0];\n                            const playerView = document.getElementById('player-view');\n                            const currentSongId = parseInt(playerView.dataset.currentSongId); \n                            if (!currentSongId) return;\n                            \n                            const objectURL = URL.createObjectURL(file);\n                            revokeURLs('player');\n                            tempObjectURLs.player.push(objectURL);\n                            playerView.style.backgroundImage = `url(${objectURL})`;\n                            \n                            db.songs.update(currentSongId, { backgroundFile: file }).then(() => { \n                                showUploadStatus('å•æ›²èƒŒæ™¯å·²ä¿å­˜'); \n                            });\n                        }\n                        document.body.removeChild(tempInput);\n                    });\n                    \n                    document.body.appendChild(tempInput);\n                    tempInput.click();\n                } else {\n                    songBgInput.click();\n                }\n            });\n            \n            songBgInput.addEventListener('change', (e) => {\n                const file = e.target.files[0]; if (!file) return;\n                const playerView = document.getElementById('player-view');\n                const currentSongId = parseInt(playerView.dataset.currentSongId); if (!currentSongId) return;\n                const objectURL = URL.createObjectURL(file);\n                revokeURLs('player');\n                tempObjectURLs.player.push(objectURL);\n                playerView.style.backgroundImage = `url(${objectURL})`;\n                db.songs.update(currentSongId, { backgroundFile: file }).then(() => { showUploadStatus('å•æ›²èƒŒæ™¯å·²ä¿å­˜'); });\n                e.target.value = '';\n            });\n\n            document.getElementById('display-picture-container').addEventListener('click', () => { \n                // å¦‚æœæ˜¯è£è€€æ‰‹æœºï¼Œä½¿ç”¨ç‰¹æ®Šæ–¹æ³•\n                if (isHonorOrHuawei) {\n                    const tempInput = document.createElement('input');\n                    tempInput.type = 'file';\n                    tempInput.accept = 'image/*';\n                    tempInput.style.display = 'none';\n                    \n                    tempInput.addEventListener('change', async function() {\n                        if (this.files && this.files.length > 0) {\n                            await db.settings.put({ key: 'displayPicture', value: this.files[0] });\n                            renderUI();\n                            showUploadStatus('å±•ç¤ºå›¾ç‰‡å·²æ›´æ–°');\n                        }\n                        document.body.removeChild(tempInput);\n                    });\n                    \n                    document.body.appendChild(tempInput);\n                    tempInput.click();\n                } else {\n                    const input = document.createElement('input'); \n                    input.type = 'file'; \n                    input.accept = 'image/*'; \n                    input.onchange = async e => { \n                        if (e.target.files[0]) { \n                            await db.settings.put({ key: 'displayPicture', value: e.target.files[0] }); \n                            renderUI(); \n                        } \n                    }; \n                    input.click();\n                }\n            });\n            \n            async function initialize() { \n                setupNavigation(); \n                setupColorPicker();\n                setupCustomControls();\n                setupSleepTimer();\n                \n                const playerView = document.getElementById('player-view');\n                const lyricBubble = document.querySelector('.lyric-bubble');\n                lyricBubble.id = 'lyric-bubble';\n                const albumArt = document.getElementById('album-art');\n                const songTitleBox = document.getElementById('song-title-box');\n\n                setupDraggableElement(lyricBubble, playerView);\n                setupDraggableElement(albumArt, playerView);\n                setupDraggableElement(songTitleBox, playerView);\n                \n                const cpSetting = await db.settings.get('continuousPlay');\n                isContinuousPlay = cpSetting ? cpSetting.value : false;\n                updateContinuousPlayUI();\n\n                setInterval(updateClock, 1000); \n                updateClock(); \n                const settingsExist = await db.settings.get('appConfig'); \n                if (!settingsExist) { await db.settings.put({ key: 'appConfig', value: defaultAppConfig }); } \n                await renderUI(); \n                navigateTo('desktop-view'); \n                \n                // æ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯\n                setTimeout(() => {\n                    if (isHonorOrHuawei) {\n                        showUploadStatus('æ¬¢è¿ä½¿ç”¨ï¼è£è€€/Huaweiç”¨æˆ·è¯·ä½¿ç”¨ä¸“ç”¨ä¸Šä¼ æŒ‰é’®');\n                    } else {\n                        showUploadStatus('æ¬¢è¿ä½¿ç”¨â™¡å‘¦ã®éŸ³ä¹â™¡æ’­æ”¾å™¨');\n                    }\n                }, 1000);\n            }\n            \n            initialize();\n        });\n    </script>\n</body>\n</html>","isHtml":false,"htmlPath":"","htmlFiles":[],"prefix":"","pcRepo":"PakePlus-v2.1.3","iosRepo":"PakePlus-iOS-v2.1.3","androidRepo":"PakePlus-Android-v2.1.3","more":{"windows":{"label":"","title":"yoyo player","url":"https://jovial-bunny-2f9433.netlify.app/","userAgent":"Mozilla/5.0 (Linux; Android 14; Pixel 6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Mobile Safari/537.36","width":412,"height":915,"theme":null,"resizable":true,"fullscreen":false,"maximized":false,"minWidth":400,"minHeight":300,"maxWidth":1920,"maxHeight":1080,"decorations":true,"transparent":false,"titleBarStyle":"Visible","visible":true,"focus":true,"closable":true,"minimizable":true,"maximizable":true,"alwaysOnTop":false,"alwaysOnBottom":false,"center":false,"shadow":true,"skipTaskbar":false,"tabbingIdentifier":null,"parent":null,"dragDropEnabled":true,"browserExtensionsEnabled":false,"devtools":true,"contentProtected":false,"hiddenTitle":false,"incognito":false,"proxyUrl":null,"useHttpsScheme":false,"zoomHotkeysEnabled":false,"acceptFirstMouse":false,"create":false,"backgroundColor":null,"backgroundThrottling":null,"javascriptDisabled":false}},"phone":{"safeArea":{"top":0,"bottom":0,"left":0,"right":0},"header":{"show":false,"title":"","backgroundColor":"","color":"","fontSize":16,"fontWeight":"bold","loading":false,"toolBar":false,"toolBarBackgroundColor":"","toolBarColor":"","toolBarFontSize":16,"toolBarFontWeight":"bold"},"siderMenu":{"show":false,"width":0,"backgroundColor":"","color":"","fontSize":16,"fontWeight":"bold","title":"","titleColor":"","titleFontSize":16,"titleFontWeight":"bold"},"tabBar":{"show":false,"backgroundColor":"","color":"","activeColor":"","fontSize":16,"fontWeight":"bold","tabBarItem":[]},"webview":{"userAgent":"","javaScriptEnabled":true,"domStorageEnabled":true,"allowFileAccess":true,"loadWithOverviewMode":true,"setSupportZoom":true,"clearCache":true}},"ios":{"name":"dfcebae","showName":"yoyo player","version":"0.0.3","webUrl":"https://jovial-bunny-2f9433.netlify.app/","id":"com.dfcebae.app.ios","icon":"./app-icon.png","desc":"Package for personal use only, please do not use for commercial purposesï¼ˆæ‰“åŒ…ä»…é™ä¸ªäººä½¿ç”¨ï¼Œè¯·å‹¿ä¼ æ’­æˆ–å•†ä¸šç”¨é€”ï¼‰","pubBody":"Package for personal use only, please do not use for commercial purposesï¼ˆæ‰“åŒ…ä»…é™ä¸ªäººä½¿ç”¨ï¼Œè¯·å‹¿ä¼ æ’­æˆ–å•†ä¸šç”¨é€”ï¼‰","isHtml":false,"debug":false,"safeArea":"all"},"android":{"name":"dfcebae","showName":"yoyo player","version":"0.0.3","webUrl":"https://jovial-bunny-2f9433.netlify.app/","id":"com.dfcebae.app.android","icon":"./app-icon.png","input":"./app-icon.png","output":"./res","rounded":true,"copyTo":"./app/src/main/res","androidResDir":"./app/src/main/res","desc":"Package for personal use only, please do not use for commercial purposesï¼ˆæ‰“åŒ…ä»…é™ä¸ªäººä½¿ç”¨ï¼Œè¯·å‹¿ä¼ æ’­æˆ–å•†ä¸šç”¨é€”ï¼‰","pubBody":"Package for personal use only, please do not use for commercial purposesï¼ˆæ‰“åŒ…ä»…é™ä¸ªäººä½¿ç”¨ï¼Œè¯·å‹¿ä¼ æ’­æˆ–å•†ä¸šç”¨é€”ï¼‰","isHtml":false,"debug":false,"safeArea":"all"},"desktop":{"name":"dfcebae","showName":"yoyo player","version":"0.0.3","id":"com.dfcebae.app.desktop","desc":"æ‰“åŒ…ä»…é™ä¸ªäººä½¿ç”¨ï¼Œè¯·å‹¿ä¼ æ’­æˆ–å•†ä¸šç”¨é€”ï¼Œå¦åˆ™åæœè‡ªè´Ÿ","webUrl":"https://jovial-bunny-2f9433.netlify.app/","iconPath":"../app-icon.png","inputPath":"../app-icon.png","tempPath":"./processed-image.png","icnsPath":"../src-tauri/icons/icon.icns","pubBody":"æ‰“åŒ…ä»…é™ä¸ªäººä½¿ç”¨ï¼Œè¯·å‹¿ä¼ æ’­æˆ–å•†ä¸šç”¨é€”ï¼Œå¦åˆ™åæœè‡ªè´Ÿ","isHtml":false,"single":true,"state":true,"injectJq":false,"tauriApi":false,"buildMethod":"local","debug":false}}